{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/hooks/useDragDrop.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\r\n\r\ninterface DragDropState {\r\n    isDragging: boolean;\r\n}\r\n\r\ninterface DragDropHandlers {\r\n    onDragOver: (e: React.DragEvent) => void;\r\n    onDragEnter: (e: React.DragEvent) => void;\r\n    onDragLeave: (e: React.DragEvent) => void;\r\n    onDrop: (e: React.DragEvent) => File | null;\r\n}\r\n\r\nexport const useDragDrop = (onFileDrop?: (file: File) => void) => {\r\n    const [isDragging, setIsDragging] = useState(false);\r\n\r\n    const onDragOver = useCallback((e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }, []);\r\n\r\n    const onDragEnter = useCallback((e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setIsDragging(true);\r\n    }, []);\r\n\r\n    const onDragLeave = useCallback((e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        \r\n        // Only set to false if we're leaving the drop zone itself, not entering a child\r\n        if (e.currentTarget.contains(e.relatedTarget as Node)) return;\r\n        \r\n        setIsDragging(false);\r\n    }, []);\r\n\r\n    const onDrop = useCallback((e: React.DragEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setIsDragging(false);\r\n\r\n        const files = e.dataTransfer.files;\r\n        if (files && files.length > 0) {\r\n            const file = files[0];\r\n            if (onFileDrop) {\r\n                onFileDrop(file);\r\n            }\r\n            return file;\r\n        }\r\n        return null;\r\n    }, [onFileDrop]);\r\n\r\n    return {\r\n        isDragging,\r\n        dragHandlers: {\r\n            onDragOver,\r\n            onDragEnter,\r\n            onDragLeave,\r\n            onDrop\r\n        }\r\n    };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;;AAaO,MAAM,cAAc,CAAC;;IACxB,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,sOAAQ,EAAC;IAE7C,MAAM,aAAa,IAAA,yOAAW;+CAAC,CAAC;YAC5B,EAAE,cAAc;YAChB,EAAE,eAAe;QACrB;8CAAG,EAAE;IAEL,MAAM,cAAc,IAAA,yOAAW;gDAAC,CAAC;YAC7B,EAAE,cAAc;YAChB,EAAE,eAAe;YACjB,cAAc;QAClB;+CAAG,EAAE;IAEL,MAAM,cAAc,IAAA,yOAAW;gDAAC,CAAC;YAC7B,EAAE,cAAc;YAChB,EAAE,eAAe;YAEjB,gFAAgF;YAChF,IAAI,EAAE,aAAa,CAAC,QAAQ,CAAC,EAAE,aAAa,GAAW;YAEvD,cAAc;QAClB;+CAAG,EAAE;IAEL,MAAM,SAAS,IAAA,yOAAW;2CAAC,CAAC;YACxB,EAAE,cAAc;YAChB,EAAE,eAAe;YACjB,cAAc;YAEd,MAAM,QAAQ,EAAE,YAAY,CAAC,KAAK;YAClC,IAAI,SAAS,MAAM,MAAM,GAAG,GAAG;gBAC3B,MAAM,OAAO,KAAK,CAAC,EAAE;gBACrB,IAAI,YAAY;oBACZ,WAAW;gBACf;gBACA,OAAO;YACX;YACA,OAAO;QACX;0CAAG;QAAC;KAAW;IAEf,OAAO;QACH;QACA,cAAc;YACV;YACA;YACA;YACA;QACJ;IACJ;AACJ;GAjDa"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/auth/components/AuthButton.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useMsal } from \"@azure/msal-react\";\r\nimport { loginRequest } from \"@/lib/msalConfig\";\r\nimport { useState } from \"react\";\r\n\r\nexport default function AuthButton() {\r\n    const { instance, accounts, inProgress } = useMsal();\r\n    const [isLoggingIn, setIsLoggingIn] = useState(false);\r\n    const account = accounts[0];\r\n\r\n    const handleLogin = () => {\r\n        setIsLoggingIn(true);\r\n        // Use redirect flow - page will redirect to Microsoft and back\r\n        instance.loginRedirect(loginRequest);\r\n    };\r\n\r\n    const handleLogout = () => {\r\n        // Clear all accounts from cache (local-only logout)\r\n        instance.clearCache();\r\n        // Redirect to login page (include basePath for production)\r\n        const basePath = process.env.NEXT_PUBLIC_BASEPATH || '';\r\n        window.location.href = `${window.location.origin}${basePath}/`;\r\n    };\r\n\r\n    const [isHovered, setIsHovered] = useState(false);\r\n\r\n    // Show loading state while MSAL is processing or logging in\r\n    if (inProgress !== \"none\" || isLoggingIn) {\r\n        return (\r\n            <button\r\n                disabled\r\n                style={{\r\n                    height: '36px',\r\n                    padding: '0 1rem',\r\n                    background: 'var(--border-default)',\r\n                    color: 'var(--text-secondary)',\r\n                    border: 'none',\r\n                    borderRadius: '5px',\r\n                    cursor: 'not-allowed',\r\n                    fontSize: '0.8rem',\r\n                    fontWeight: '600',\r\n                    textTransform: 'uppercase',\r\n                    letterSpacing: '0.5px',\r\n                    display: 'flex',\r\n                    alignItems: 'center'\r\n                }}\r\n            >\r\n                ...\r\n            </button>\r\n        );\r\n    }\r\n\r\n    if (account) {\r\n        return (\r\n            <button\r\n                onClick={handleLogout}\r\n                onMouseEnter={() => setIsHovered(true)}\r\n                onMouseLeave={() => setIsHovered(false)}\r\n                style={{\r\n                    height: '36px',\r\n                    padding: '0 1.25rem',\r\n                    background: isHovered ? 'var(--status-error)' : 'var(--header-btn-auth-bg)',\r\n                    color: 'var(--header-btn-auth-text)',\r\n                    border: 'none',\r\n                    borderRadius: '5px',\r\n                    cursor: 'pointer',\r\n                    fontSize: '0.8rem',\r\n                    fontWeight: '600',\r\n                    transition: 'all 0.2s ease',\r\n                    textTransform: 'uppercase',\r\n                    letterSpacing: '0.5px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    minWidth: '100px',\r\n                    justifyContent: 'center'\r\n                }}\r\n                title={`Signed in as ${account.username}`}\r\n            >\r\n                {isHovered ? 'LOGOUT' : (account.name?.split(' ')[0]?.toUpperCase() || 'USER')}\r\n            </button>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <button\r\n            onClick={handleLogin}\r\n            style={{\r\n                height: '36px',\r\n                padding: '0 1.25rem',\r\n                background: 'var(--header-btn-auth-bg)',\r\n                color: 'var(--header-btn-auth-text)',\r\n                border: 'none',\r\n                borderRadius: '5px',\r\n                cursor: 'pointer',\r\n                fontSize: '0.8rem',\r\n                fontWeight: '600',\r\n                transition: 'background 0.2s',\r\n                textTransform: 'uppercase',\r\n                letterSpacing: '0.5px',\r\n                display: 'flex',\r\n                alignItems: 'center'\r\n            }}\r\n            onMouseEnter={(e) => e.currentTarget.style.background = 'var(--primary-hover)'}\r\n            onMouseLeave={(e) => e.currentTarget.style.background = 'var(--header-btn-auth-bg)'}\r\n        >\r\n            LOGIN\r\n        </button>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAqByB;;AAnBzB;AAAA;AACA;AACA;;;AAJA;;;;AAMe,SAAS;;IACpB,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,IAAA,+OAAO;IAClD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,sOAAQ,EAAC;IAC/C,MAAM,UAAU,QAAQ,CAAC,EAAE;IAE3B,MAAM,cAAc;QAChB,eAAe;QACf,+DAA+D;QAC/D,SAAS,aAAa,CAAC,wMAAY;IACvC;IAEA,MAAM,eAAe;QACjB,oDAAoD;QACpD,SAAS,UAAU;QACnB,2DAA2D;QAC3D,MAAM,WAAW,wCAAoC;QACrD,OAAO,QAAQ,CAAC,IAAI,GAAG,GAAG,OAAO,QAAQ,CAAC,MAAM,GAAG,SAAS,CAAC,CAAC;IAClE;IAEA,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,sOAAQ,EAAC;IAE3C,4DAA4D;IAC5D,IAAI,eAAe,UAAU,aAAa;QACtC,qBACI,0PAAC;YACG,QAAQ;YACR,OAAO;gBACH,QAAQ;gBACR,SAAS;gBACT,YAAY;gBACZ,OAAO;gBACP,QAAQ;gBACR,cAAc;gBACd,QAAQ;gBACR,UAAU;gBACV,YAAY;gBACZ,eAAe;gBACf,eAAe;gBACf,SAAS;gBACT,YAAY;YAChB;sBACH;;;;;;IAIT;IAEA,IAAI,SAAS;QACT,qBACI,0PAAC;YACG,SAAS;YACT,cAAc,IAAM,aAAa;YACjC,cAAc,IAAM,aAAa;YACjC,OAAO;gBACH,QAAQ;gBACR,SAAS;gBACT,YAAY,YAAY,wBAAwB;gBAChD,OAAO;gBACP,QAAQ;gBACR,cAAc;gBACd,QAAQ;gBACR,UAAU;gBACV,YAAY;gBACZ,YAAY;gBACZ,eAAe;gBACf,eAAe;gBACf,SAAS;gBACT,YAAY;gBACZ,UAAU;gBACV,gBAAgB;YACpB;YACA,OAAO,CAAC,aAAa,EAAE,QAAQ,QAAQ,EAAE;sBAExC,YAAY,WAAY,QAAQ,IAAI,EAAE,MAAM,IAAI,CAAC,EAAE,EAAE,iBAAiB;;;;;;IAGnF;IAEA,qBACI,0PAAC;QACG,SAAS;QACT,OAAO;YACH,QAAQ;YACR,SAAS;YACT,YAAY;YACZ,OAAO;YACP,QAAQ;YACR,cAAc;YACd,QAAQ;YACR,UAAU;YACV,YAAY;YACZ,YAAY;YACZ,eAAe;YACf,eAAe;YACf,SAAS;YACT,YAAY;QAChB;QACA,cAAc,CAAC,IAAM,EAAE,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG;QACxD,cAAc,CAAC,IAAM,EAAE,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG;kBAC3D;;;;;;AAIT;GAvGwB;;QACuB,+OAAO;;;KAD9B"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/shared/utils/apiPath.ts"],"sourcesContent":["/**\r\n * Get the API base path for the current environment.\r\n * In production, this includes the basePath from next.config.ts.\r\n * In development, it's just the root path.\r\n */\r\nexport function getApiPath(endpoint: string): string {\r\n    const basePath = process.env.NEXT_PUBLIC_BASEPATH || '';\r\n    const normalizedEndpoint = endpoint.startsWith('/') ? endpoint : `/${endpoint}`;\r\n    return `${basePath}${normalizedEndpoint}`;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAEoB;AADd,SAAS,WAAW,QAAgB;IACvC,MAAM,WAAW,wCAAoC;IACrD,MAAM,qBAAqB,SAAS,UAAU,CAAC,OAAO,WAAW,CAAC,CAAC,EAAE,UAAU;IAC/E,OAAO,GAAG,WAAW,oBAAoB;AAC7C"}},
    {"offset": {"line": 226, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/shared/utils/formatDate.ts"],"sourcesContent":["/**\r\n * Format an ISO date string into a human-readable display string.\r\n * Handles 'N/A' and invalid dates gracefully.\r\n * Single source of truth — replaces 2 duplicate implementations.\r\n */\r\nexport function formatDate(dateStr?: string): string {\r\n    if (!dateStr || dateStr === 'N/A') return 'No due date';\r\n    try {\r\n        const date = new Date(dateStr);\r\n        return date.toLocaleDateString('en-US', {\r\n            month: 'short',\r\n            day: 'numeric',\r\n            year: 'numeric',\r\n        });\r\n    } catch {\r\n        return dateStr;\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AACM,SAAS,WAAW,OAAgB;IACvC,IAAI,CAAC,WAAW,YAAY,OAAO,OAAO;IAC1C,IAAI;QACA,MAAM,OAAO,IAAI,KAAK;QACtB,OAAO,KAAK,kBAAkB,CAAC,SAAS;YACpC,OAAO;YACP,KAAK;YACL,MAAM;QACV;IACJ,EAAE,OAAM;QACJ,OAAO;IACX;AACJ"}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/shared/utils/formatSize.ts"],"sourcesContent":["/**\r\n * Format a byte count into a human-readable size string (B, KB, MB, GB).\r\n */\r\nexport function formatSize(bytes?: number): string {\r\n    if (!bytes) return '';\r\n    if (bytes < 1024) return `${bytes} B`;\r\n    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(0)} KB`;\r\n    if (bytes < 1024 * 1024 * 1024) return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\r\n    return `${(bytes / (1024 * 1024 * 1024)).toFixed(1)} GB`;\r\n}\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,SAAS,WAAW,KAAc;IACrC,IAAI,CAAC,OAAO,OAAO;IACnB,IAAI,QAAQ,MAAM,OAAO,GAAG,MAAM,EAAE,CAAC;IACrC,IAAI,QAAQ,OAAO,MAAM,OAAO,GAAG,CAAC,QAAQ,IAAI,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC;IACjE,IAAI,QAAQ,OAAO,OAAO,MAAM,OAAO,GAAG,CAAC,QAAQ,CAAC,OAAO,IAAI,CAAC,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC;IACjF,OAAO,GAAG,CAAC,QAAQ,CAAC,OAAO,OAAO,IAAI,CAAC,EAAE,OAAO,CAAC,GAAG,GAAG,CAAC;AAC5D"}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/upload/components/SharePoint/SharePointPicker.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useMsal } from \"@azure/msal-react\";\r\nimport { useState, useCallback, useEffect } from \"react\";\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\nimport { formatTime } from '@/shared/utils/formatTime';\r\nimport { formatDate } from '@/shared/utils/formatDate';\r\nimport { formatSize } from '@/shared/utils/formatSize';\r\n\r\nconst GRAPH_BASE = \"https://graph.microsoft.com/v1.0\";\r\nconst VIDEO_EXTENSIONS = ['.mp4', '.avi', '.mov', '.mkv', '.webm', '.m4v', '.wmv'];\r\n\r\ninterface DriveItem {\r\n    id: string;\r\n    name: string;\r\n    size?: number;\r\n    folder?: { childCount: number };\r\n    file?: { mimeType: string };\r\n    lastModifiedDateTime?: string;\r\n    '@microsoft.graph.downloadUrl'?: string;\r\n    remoteItem?: {\r\n        id: string;\r\n        parentReference?: { driveId?: string };\r\n        folder?: { childCount: number };\r\n        file?: { mimeType: string };\r\n    };\r\n}\r\n\r\ninterface SiteInfo {\r\n    id: string;\r\n    displayName: string;\r\n    webUrl?: string;\r\n}\r\n\r\ninterface DriveInfo {\r\n    id: string;\r\n    name: string;\r\n    driveType?: string;\r\n    description?: string;\r\n}\r\n\r\ninterface BreadcrumbItem {\r\n    id: string;\r\n    name: string;\r\n    driveId?: string; // Track which drive we're in\r\n}\r\n\r\n// The different \"views\" or sources the user can browse\r\ntype BrowseSource = 'home' | 'myfiles' | 'shared' | 'sites' | 'site-drives' | 'drive-browse';\r\n\r\n/** Result returned when a file is imported server-side from SharePoint */\r\nexport interface ServerImportResult {\r\n    mediaId: string;\r\n    fileName: string;\r\n    fileSize: number;\r\n    isServerImport: true;\r\n}\r\n\r\ninterface SharePointPickerProps {\r\n    onFileSelected: (file: File | ServerImportResult) => void;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n}\r\n\r\nexport default function SharePointPicker({ onFileSelected, isOpen, onClose }: SharePointPickerProps) {\r\n    const { instance, accounts } = useMsal();\r\n    const [items, setItems] = useState<DriveItem[]>([]);\r\n    const [sites, setSites] = useState<SiteInfo[]>([]);\r\n    const [drives, setDrives] = useState<DriveInfo[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [downloading, setDownloading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [breadcrumbs, setBreadcrumbs] = useState<BreadcrumbItem[]>([]);\r\n    const [selectedItem, setSelectedItem] = useState<DriveItem | null>(null);\r\n    const [browseSource, setBrowseSource] = useState<BrowseSource>('home');\r\n    const [currentDriveId, setCurrentDriveId] = useState<string | null>(null);\r\n    const [currentSiteId, setCurrentSiteId] = useState<string | null>(null);\r\n    const [currentSiteName, setCurrentSiteName] = useState<string>('');\r\n    const [searchQuery, setSearchQuery] = useState<string>('');\r\n    const [isSearchMode, setIsSearchMode] = useState<boolean>(false);\r\n    const [originalSites, setOriginalSites] = useState<SiteInfo[]>([]);\r\n    const [originalDrives, setOriginalDrives] = useState<DriveInfo[]>([]);\r\n\r\n    // Get a Graph API token\r\n    const getToken = useCallback(async (): Promise<string> => {\r\n        const scopes = [\"Files.Read.All\", \"Sites.Read.All\"];\r\n        try {\r\n            const resp = await instance.acquireTokenSilent({ scopes, account: accounts[0] });\r\n            return resp.accessToken;\r\n        } catch {\r\n            const resp = await instance.acquireTokenPopup({ scopes, account: accounts[0] });\r\n            return resp.accessToken;\r\n        }\r\n    }, [instance, accounts]);\r\n\r\n    // Generic Graph API fetch\r\n    const graphFetch = useCallback(async (url: string) => {\r\n        const token = await getToken();\r\n        const resp = await fetch(url, {\r\n            headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        if (!resp.ok) {\r\n            const errBody = await resp.text();\r\n            console.error('Graph API error:', resp.status, errBody);\r\n            throw new Error(`Graph API error (${resp.status})`);\r\n        }\r\n        return resp.json();\r\n    }, [getToken]);\r\n\r\n    // Filter and sort items (folders + video files)\r\n    const processItems = (allItems: DriveItem[]): DriveItem[] => {\r\n        const filtered = allItems.filter(item => {\r\n            if (item.folder) return true;\r\n            // For shared items, check remoteItem\r\n            if (item.remoteItem?.folder) return true;\r\n            if (item.file || item.remoteItem?.file) {\r\n                const ext = '.' + item.name.split('.').pop()?.toLowerCase();\r\n                return VIDEO_EXTENSIONS.includes(ext);\r\n            }\r\n            return false;\r\n        });\r\n        filtered.sort((a, b) => {\r\n            const aIsFolder = !!(a.folder || a.remoteItem?.folder);\r\n            const bIsFolder = !!(b.folder || b.remoteItem?.folder);\r\n            if (aIsFolder && !bIsFolder) return -1;\r\n            if (!aIsFolder && bIsFolder) return 1;\r\n            return a.name.localeCompare(b.name);\r\n        });\r\n        return filtered;\r\n    };\r\n\r\n    // Fetch items from personal OneDrive\r\n    const fetchMyFiles = useCallback(async (folderId?: string) => {\r\n        setLoading(true);\r\n        setError(null);\r\n        setSelectedItem(null);\r\n        try {\r\n            const url = folderId\r\n                ? `${GRAPH_BASE}/me/drive/items/${folderId}/children?$top=200&$orderby=name`\r\n                : `${GRAPH_BASE}/me/drive/root/children?$top=200&$orderby=name`;\r\n            const data = await graphFetch(url);\r\n            setItems(processItems(data.value || []));\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to load files');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [graphFetch]);\r\n\r\n    // Fetch \"Shared with Me\" items\r\n    const fetchSharedWithMe = useCallback(async () => {\r\n        setLoading(true);\r\n        setError(null);\r\n        setSelectedItem(null);\r\n        try {\r\n            const data = await graphFetch(`${GRAPH_BASE}/me/drive/sharedWithMe?$top=200`);\r\n            setItems(processItems(data.value || []));\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to load shared files');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [graphFetch]);\r\n\r\n    // Fetch SharePoint sites\r\n    const fetchSites = useCallback(async () => {\r\n        setLoading(true);\r\n        setError(null);\r\n        setSelectedItem(null);\r\n        try {\r\n            const data = await graphFetch(`${GRAPH_BASE}/sites?search=*&$top=100`);\r\n            const sitesList = data.value || [];\r\n            setSites(sitesList);\r\n            setOriginalSites(sitesList);\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to load sites');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [graphFetch]);\r\n\r\n    // Fetch drives within a SharePoint site\r\n    const fetchSiteDrives = useCallback(async (siteId: string) => {\r\n        setLoading(true);\r\n        setError(null);\r\n        setSelectedItem(null);\r\n        try {\r\n            const data = await graphFetch(`${GRAPH_BASE}/sites/${siteId}/drives`);\r\n            const drivesList = data.value || [];\r\n            setDrives(drivesList);\r\n            setOriginalDrives(drivesList);\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to load document libraries');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [graphFetch]);\r\n\r\n    // Fetch items from a specific drive (SharePoint library or shared drive)\r\n    const fetchDriveItems = useCallback(async (driveId: string, folderId?: string) => {\r\n        setLoading(true);\r\n        setError(null);\r\n        setSelectedItem(null);\r\n        setIsSearchMode(false);\r\n        try {\r\n            const url = folderId\r\n                ? `${GRAPH_BASE}/drives/${driveId}/items/${folderId}/children?$top=200&$orderby=name`\r\n                : `${GRAPH_BASE}/drives/${driveId}/root/children?$top=200&$orderby=name`;\r\n            const data = await graphFetch(url);\r\n            setItems(processItems(data.value || []));\r\n        } catch (err: any) {\r\n            setError(err.message || 'Failed to load files');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [graphFetch]);\r\n\r\n    // Search for items across the current context\r\n    const performSearch = useCallback(async (query: string) => {\r\n        if (!query.trim()) {\r\n            setIsSearchMode(false);\r\n            setSearchQuery('');\r\n            // Restore original lists or reload current view\r\n            if (browseSource === 'sites') {\r\n                setSites(originalSites);\r\n            } else if (browseSource === 'site-drives') {\r\n                setDrives(originalDrives);\r\n            } else if (browseSource === 'myfiles') {\r\n                if (breadcrumbs.length > 0) {\r\n                    await fetchMyFiles(breadcrumbs[breadcrumbs.length - 1].id);\r\n                } else {\r\n                    await fetchMyFiles();\r\n                }\r\n            } else if (browseSource === 'shared') {\r\n                await fetchSharedWithMe();\r\n            } else if (browseSource === 'drive-browse' && currentDriveId) {\r\n                if (breadcrumbs.length > 0) {\r\n                    await fetchDriveItems(currentDriveId, breadcrumbs[breadcrumbs.length - 1].id);\r\n                } else {\r\n                    await fetchDriveItems(currentDriveId);\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        setSelectedItem(null);\r\n        setIsSearchMode(true);\r\n\r\n        // Client-side filter for sites and drives\r\n        if (browseSource === 'sites') {\r\n            const filtered = originalSites.filter(site =>\r\n                site.displayName.toLowerCase().includes(query.toLowerCase())\r\n            );\r\n            setSites(filtered);\r\n            return;\r\n        }\r\n\r\n        if (browseSource === 'site-drives') {\r\n            const filtered = originalDrives.filter(drive =>\r\n                drive.name.toLowerCase().includes(query.toLowerCase())\r\n            );\r\n            setDrives(filtered);\r\n            return;\r\n        }\r\n\r\n        // Graph API search for files\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            let url: string;\r\n            if (currentDriveId) {\r\n                url = `${GRAPH_BASE}/drives/${currentDriveId}/root/search(q='${encodeURIComponent(query)}')?$top=200`;\r\n            } else {\r\n                url = `${GRAPH_BASE}/me/drive/root/search(q='${encodeURIComponent(query)}')?$top=200`;\r\n            }\r\n            const data = await graphFetch(url);\r\n            setItems(processItems(data.value || []));\r\n        } catch (err: any) {\r\n            setError(err.message || 'Search failed');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    }, [graphFetch, browseSource, breadcrumbs, currentDriveId, fetchMyFiles, fetchDriveItems]);\r\n\r\n    // Auto-load home when opened\r\n    useEffect(() => {\r\n        if (isOpen && accounts[0]) {\r\n            goHome();\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [isOpen, accounts]);\r\n\r\n    // Go to the home/source picker view\r\n    const goHome = () => {\r\n        setBrowseSource('home');\r\n        setBreadcrumbs([]);\r\n        setItems([]);\r\n        setSites([]);\r\n        setDrives([]);\r\n        setSelectedItem(null);\r\n        setError(null);\r\n        setCurrentDriveId(null);\r\n        setCurrentSiteId(null);\r\n        setCurrentSiteName('');\r\n    };\r\n\r\n    // Navigate into \"My Files\"\r\n    const openMyFiles = async () => {\r\n        setBrowseSource('myfiles');\r\n        setBreadcrumbs([]);\r\n        setCurrentDriveId(null);\r\n        await fetchMyFiles();\r\n    };\r\n\r\n    // Navigate into \"Shared with Me\"\r\n    const openSharedWithMe = async () => {\r\n        setBrowseSource('shared');\r\n        setBreadcrumbs([]);\r\n        setCurrentDriveId(null);\r\n        await fetchSharedWithMe();\r\n    };\r\n\r\n    // Navigate into \"SharePoint Sites\"\r\n    const openSites = async () => {\r\n        setBrowseSource('sites');\r\n        setBreadcrumbs([]);\r\n        setCurrentDriveId(null);\r\n        await fetchSites();\r\n    };\r\n\r\n    // Open a specific SharePoint site's document libraries\r\n    const openSiteDrives = async (site: SiteInfo) => {\r\n        setBrowseSource('site-drives');\r\n        setCurrentSiteId(site.id);\r\n        setCurrentSiteName(site.displayName);\r\n        setBreadcrumbs([]);\r\n        await fetchSiteDrives(site.id);\r\n    };\r\n\r\n    // Open a specific drive (document library)\r\n    const openDrive = async (drive: DriveInfo) => {\r\n        setBrowseSource('drive-browse');\r\n        setCurrentDriveId(drive.id);\r\n        setBreadcrumbs([{ id: 'root', name: drive.name, driveId: drive.id }]);\r\n        await fetchDriveItems(drive.id);\r\n    };\r\n\r\n    // Navigate into a folder\r\n    const navigateToFolder = async (item: DriveItem) => {\r\n        // For shared items with remoteItem, we need to switch to that drive\r\n        if (item.remoteItem?.folder && item.remoteItem.parentReference?.driveId) {\r\n            const remoteDriveId = item.remoteItem.parentReference.driveId;\r\n            const remoteItemId = item.remoteItem.id;\r\n            setBrowseSource('drive-browse');\r\n            setCurrentDriveId(remoteDriveId);\r\n            setBreadcrumbs(prev => [...prev, { id: remoteItemId, name: item.name, driveId: remoteDriveId }]);\r\n            await fetchDriveItems(remoteDriveId, remoteItemId);\r\n            return;\r\n        }\r\n\r\n        const driveId = currentDriveId;\r\n        setBreadcrumbs(prev => [...prev, { id: item.id, name: item.name, driveId: driveId || undefined }]);\r\n\r\n        if (driveId) {\r\n            await fetchDriveItems(driveId, item.id);\r\n        } else {\r\n            await fetchMyFiles(item.id);\r\n        }\r\n    };\r\n\r\n    // Navigate via breadcrumb\r\n    const navigateToBreadcrumb = async (index: number) => {\r\n        if (index < 0) {\r\n            // Go back to root of current source\r\n            if (browseSource === 'myfiles') {\r\n                setBreadcrumbs([]);\r\n                await fetchMyFiles();\r\n            } else if (browseSource === 'shared') {\r\n                setBreadcrumbs([]);\r\n                await fetchSharedWithMe();\r\n            } else if (browseSource === 'drive-browse' && currentDriveId) {\r\n                const rootBc = breadcrumbs[0]; // Keep the drive name\r\n                setBreadcrumbs(rootBc ? [rootBc] : []);\r\n                await fetchDriveItems(currentDriveId);\r\n            }\r\n        } else {\r\n            const target = breadcrumbs[index];\r\n            setBreadcrumbs(prev => prev.slice(0, index + 1));\r\n            const driveId = target.driveId || currentDriveId;\r\n            if (target.id === 'root' && driveId) {\r\n                await fetchDriveItems(driveId);\r\n            } else if (driveId) {\r\n                await fetchDriveItems(driveId, target.id);\r\n            } else {\r\n                await fetchMyFiles(target.id);\r\n            }\r\n        }\r\n    };\r\n\r\n    // Import file via server-side download (On-Behalf-Of flow)\r\n    const selectFile = async (item: DriveItem) => {\r\n        setDownloading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const token = await getToken();\r\n\r\n            // Determine the effective driveId and itemId for the Graph API call\r\n            let effectiveDriveId: string;\r\n            let effectiveItemId: string;\r\n\r\n            if (item.remoteItem?.parentReference?.driveId) {\r\n                // Shared items have a remote reference with the source drive\r\n                effectiveDriveId = item.remoteItem.parentReference.driveId;\r\n                effectiveItemId = item.remoteItem.id;\r\n            } else if (currentDriveId) {\r\n                // Browsing a specific drive (SharePoint site or selected drive)\r\n                effectiveDriveId = currentDriveId;\r\n                effectiveItemId = item.id;\r\n            } else {\r\n                // My Files — resolve the user's default drive ID\r\n                const meResp = await fetch(`${GRAPH_BASE}/me/drive`, {\r\n                    headers: { Authorization: `Bearer ${token}` }\r\n                });\r\n                if (!meResp.ok) throw new Error('Failed to get user drive info');\r\n                const meDrive = await meResp.json();\r\n                effectiveDriveId = meDrive.id;\r\n                effectiveItemId = item.id;\r\n            }\r\n\r\n            // Send metadata to server for direct download\r\n            const importResp = await fetch(getApiPath('/api/sharepoint/import'), {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    driveId: effectiveDriveId,\r\n                    itemId: effectiveItemId,\r\n                    fileName: item.name,\r\n                    accessToken: token\r\n                })\r\n            });\r\n\r\n            if (!importResp.ok) {\r\n                const errData = await importResp.json().catch(() => ({}));\r\n                throw new Error(errData.error || `Server import failed (${importResp.status})`);\r\n            }\r\n\r\n            const result = await importResp.json();\r\n\r\n            onFileSelected({\r\n                mediaId: result.mediaId,\r\n                fileName: result.fileName || item.name,\r\n                fileSize: result.fileSize,\r\n                isServerImport: true\r\n            });\r\n            onClose();\r\n        } catch (err: any) {\r\n            console.error('Server import error:', err);\r\n            setError(err.message || 'Failed to import file from SharePoint');\r\n        } finally {\r\n            setDownloading(false);\r\n        }\r\n    };\r\n\r\n    // formatSize imported from @/shared/utils/formatSize\r\n    // formatDate imported from @/shared/utils/formatDate\r\n\r\n    // Get the breadcrumb label for the current source\r\n    const getSourceLabel = (): string => {\r\n        switch (browseSource) {\r\n            case 'myfiles': return 'My Files';\r\n            case 'shared': return 'Shared with Me';\r\n            case 'sites': return 'SharePoint Sites';\r\n            case 'site-drives': return currentSiteName || 'Document Libraries';\r\n            case 'drive-browse': return breadcrumbs[0]?.name || 'Files';\r\n            default: return 'Home';\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <>\r\n            {/* Modal Overlay */}\r\n            <div style={{\r\n                position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n                backgroundColor: 'var(--modal-overlay)',\r\n                zIndex: 10000,\r\n                display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n            }} onClick={onClose}>\r\n                <div style={{\r\n                    background: 'var(--sharepoint-bg)',\r\n                    borderRadius: '12px',\r\n                    width: '720px',\r\n                    maxWidth: '95vw',\r\n                    maxHeight: '80vh',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    boxShadow: 'var(--modal-overlay)',\r\n                    overflow: 'hidden'\r\n                }} onClick={(e) => e.stopPropagation()}>\r\n\r\n                    {/* Header */}\r\n                    <div style={{\r\n                        padding: '1rem 1.25rem',\r\n                        borderBottom: '1px solid var(--modal-border)',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'space-between',\r\n                        background: 'var(--modal-header-bg)'\r\n                    }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>\r\n                            <svg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                <path d=\"M12.5 2H8.5C7.57 2 6.67 2.37 6 3L3 6C2.37 6.67 2 7.57 2 8.5V19C2 20.1 2.9 21 4 21H20C21.1 21 22 20.1 22 19V8C22 6.9 21.1 6 20 6H13L12.5 2Z\" fill=\"var(--sharepoint-icon-folder)\" />\r\n                            </svg>\r\n                            <span style={{ color: 'var(--text-primary)', fontWeight: '700', fontSize: '1.05rem' }}>\r\n                                OneDrive & SharePoint Browser\r\n                            </span>\r\n                        </div>\r\n                        <button onClick={onClose} style={{\r\n                            background: 'none', border: 'none', color: 'var(--modal-text-secondary)',\r\n                            fontSize: '1.5rem', cursor: 'pointer', lineHeight: 1,\r\n                            padding: '0 4px'\r\n                        }}>×</button>\r\n                    </div>\r\n\r\n                    {/* Breadcrumbs / Navigation */}\r\n                    {browseSource !== 'home' && (\r\n                        <div style={{\r\n                            padding: '0.6rem 1.25rem',\r\n                            borderBottom: '1px solid var(--modal-border)',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '0.25rem',\r\n                            flexWrap: 'wrap',\r\n                            fontSize: '0.85rem'\r\n                        }}>\r\n                            {/* Home button */}\r\n                            <button onClick={goHome} style={{\r\n                                background: 'none', border: 'none', color: 'var(--sharepoint-breadcrumb-text)',\r\n                                cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                fontWeight: '600', fontSize: '0.85rem'\r\n                            }}>\r\n                                ⌂ Home\r\n                            </button>\r\n                            <span style={{ color: 'var(--modal-border)' }}>›</span>\r\n\r\n                            {/* Source label */}\r\n                            {browseSource === 'site-drives' ? (\r\n                                <>\r\n                                    <button onClick={openSites} style={{\r\n                                        background: 'none', border: 'none', color: 'var(--sharepoint-breadcrumb-text)',\r\n                                        cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                        fontWeight: '400', fontSize: '0.85rem'\r\n                                    }}>\r\n                                        SharePoint Sites\r\n                                    </button>\r\n                                    <span style={{ color: 'var(--modal-border)' }}>›</span>\r\n                                    <span style={{ color: 'var(--sharepoint-breadcrumb-text)', padding: '2px 4px', fontWeight: '600', fontSize: '0.85rem' }}>\r\n                                        {currentSiteName}\r\n                                    </span>\r\n                                </>\r\n                            ) : browseSource === 'drive-browse' && currentSiteId ? (\r\n                                <>\r\n                                    <button onClick={openSites} style={{\r\n                                        background: 'none', border: 'none', color: 'var(--sharepoint-breadcrumb-text)',\r\n                                        cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                        fontWeight: '400', fontSize: '0.85rem'\r\n                                    }}>\r\n                                        SharePoint Sites\r\n                                    </button>\r\n                                    <span style={{ color: 'var(--modal-border)' }}>›</span>\r\n                                    <button onClick={() => currentSiteId && openSiteDrives({ id: currentSiteId, displayName: currentSiteName })} style={{\r\n                                        background: 'none', border: 'none', color: 'var(--sharepoint-breadcrumb-text)',\r\n                                        cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                        fontWeight: '400', fontSize: '0.85rem'\r\n                                    }}>\r\n                                        {currentSiteName}\r\n                                    </button>\r\n                                    {breadcrumbs.map((bc, i) => (\r\n                                        <span key={bc.id + i} style={{ display: 'flex', alignItems: 'center', gap: '0.25rem' }}>\r\n                                            <span style={{ color: 'var(--modal-border)' }}>›</span>\r\n                                            <button onClick={() => navigateToBreadcrumb(i)} style={{\r\n                                                background: 'none', border: 'none',\r\n                                                color: i === breadcrumbs.length - 1 ? 'var(--modal-text-secondary)' : 'var(--sharepoint-breadcrumb-text)',\r\n                                                cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                                fontWeight: i === breadcrumbs.length - 1 ? '600' : '400',\r\n                                                fontSize: '0.85rem'\r\n                                            }}>\r\n                                                {bc.name}\r\n                                            </button>\r\n                                        </span>\r\n                                    ))}\r\n                                </>\r\n                            ) : (\r\n                                <>\r\n                                    <button onClick={() => {\r\n                                        if (browseSource === 'myfiles') {\r\n                                            setBreadcrumbs([]);\r\n                                            fetchMyFiles();\r\n                                        } else if (browseSource === 'shared') {\r\n                                            setBreadcrumbs([]);\r\n                                            fetchSharedWithMe();\r\n                                        } else if (browseSource === 'sites') {\r\n                                            fetchSites();\r\n                                        }\r\n                                    }} style={{\r\n                                        background: 'none', border: 'none',\r\n                                        color: breadcrumbs.length > 0 ? 'var(--sharepoint-breadcrumb-text)' : 'var(--modal-text-secondary)',\r\n                                        cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                        fontWeight: breadcrumbs.length > 0 ? '400' : '600',\r\n                                        fontSize: '0.85rem'\r\n                                    }}>\r\n                                        {getSourceLabel()}\r\n                                    </button>\r\n                                    {breadcrumbs.map((bc, i) => (\r\n                                        <span key={bc.id + i} style={{ display: 'flex', alignItems: 'center', gap: '0.25rem' }}>\r\n                                            <span style={{ color: 'var(--modal-border)' }}>›</span>\r\n                                            <button onClick={() => navigateToBreadcrumb(i)} style={{\r\n                                                background: 'none', border: 'none',\r\n                                                color: i === breadcrumbs.length - 1 ? 'var(--modal-text-secondary)' : 'var(--sharepoint-breadcrumb-text)',\r\n                                                cursor: 'pointer', padding: '2px 4px', borderRadius: '3px',\r\n                                                fontWeight: i === breadcrumbs.length - 1 ? '600' : '400',\r\n                                                fontSize: '0.85rem'\r\n                                            }}>\r\n                                                {bc.name}\r\n                                            </button>\r\n                                        </span>\r\n                                    ))}\r\n                                </>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Search Bar - Show in all views except home */}\r\n                    {browseSource !== 'home' && (\r\n                        <div style={{\r\n                            padding: '0.75rem 1.25rem',\r\n                            borderBottom: '1px solid var(--modal-border)',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '0.5rem'\r\n                        }}>\r\n                            {/* Search Icon */}\r\n                            <svg width=\"18\" height=\"18\" viewBox=\"0 0 24 24\" fill=\"none\" style={{ flexShrink: 0 }}>\r\n                                <circle cx=\"11\" cy=\"11\" r=\"8\" stroke=\"var(--modal-text-secondary)\" strokeWidth=\"2\" />\r\n                                <path d=\"M21 21l-4.35-4.35\" stroke=\"var(--modal-text-secondary)\" strokeWidth=\"2\" strokeLinecap=\"round\" />\r\n                            </svg>\r\n\r\n                            {/* Search Input */}\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder={isSearchMode ? \"Search results...\" : \"Search files and folders...\"}\r\n                                value={searchQuery}\r\n                                onChange={(e) => setSearchQuery(e.target.value)}\r\n                                onKeyDown={(e) => {\r\n                                    if (e.key === 'Enter') {\r\n                                        performSearch(searchQuery);\r\n                                    }\r\n                                }}\r\n                                style={{\r\n                                    flex: 1,\r\n                                    background: 'var(--sharepoint-search-input-bg)',\r\n                                    border: '1px solid var(--modal-border)',\r\n                                    borderRadius: '6px',\r\n                                    padding: '0.5rem 0.75rem',\r\n                                    color: 'var(--text-primary)',\r\n                                    fontSize: '0.85rem',\r\n                                    outline: 'none'\r\n                                }}\r\n                                onFocus={(e) => e.currentTarget.style.borderColor = 'var(--primary)'}\r\n                                onBlur={(e) => e.currentTarget.style.borderColor = 'var(--modal-border)'}\r\n                            />\r\n\r\n                            {/* Search/Clear Button */}\r\n                            {searchQuery && (\r\n                                <button\r\n                                    onClick={() => {\r\n                                        if (isSearchMode) {\r\n                                            performSearch(''); // Clear search\r\n                                        } else {\r\n                                            performSearch(searchQuery); // Execute search\r\n                                        }\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '0.5rem 1rem',\r\n                                        background: isSearchMode ? 'var(--modal-border)' : 'var(--sharepoint-btn-search-bg)',\r\n                                        color: 'white',\r\n                                        border: 'none',\r\n                                        borderRadius: '6px',\r\n                                        cursor: 'pointer',\r\n                                        fontSize: '0.8rem',\r\n                                        fontWeight: '600',\r\n                                        flexShrink: 0\r\n                                    }}\r\n                                >\r\n                                    {isSearchMode ? '✕ Clear' : 'Search'}\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Content Area */}\r\n                    <div style={{\r\n                        flex: 1,\r\n                        overflowY: 'auto',\r\n                        padding: '0.5rem 0',\r\n                        minHeight: '300px'\r\n                    }}>\r\n                        {/* HOME VIEW — Source Picker */}\r\n                        {browseSource === 'home' && !loading && (\r\n                            <div style={{ padding: '1.5rem 1.25rem', display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>\r\n                                <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem', textTransform: 'uppercase', letterSpacing: '1px', marginBottom: '0.25rem' }}>\r\n                                    Choose a location\r\n                                </div>\r\n\r\n                                {/* My Files */}\r\n                                <button onClick={openMyFiles} style={{\r\n                                    display: 'flex', alignItems: 'center', gap: '1rem',\r\n                                    padding: '1rem 1.25rem', background: 'var(--sharepoint-header-bg)',\r\n                                    border: '1px solid var(--modal-border)', borderRadius: '10px',\r\n                                    cursor: 'pointer', textAlign: 'left', width: '100%',\r\n                                    transition: 'all 0.15s'\r\n                                }}\r\n                                    onMouseEnter={e => { e.currentTarget.style.background = 'var(--sharepoint-item-selected)'; e.currentTarget.style.borderColor = 'var(--sharepoint-breadcrumb-text)'; }}\r\n                                    onMouseLeave={e => { e.currentTarget.style.background = 'var(--sharepoint-header-bg)'; e.currentTarget.style.borderColor = 'var(--modal-border)'; }}\r\n                                >\r\n                                    <div style={{ width: '40px', height: '40px', borderRadius: '8px', background: 'var(--ms-blue)', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>\r\n                                        <svg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"white\"><path d=\"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z\" /></svg>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div style={{ color: 'var(--modal-text-primary)', fontWeight: '600', fontSize: '0.95rem' }}>My Files</div>\r\n                                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem' }}>Your personal OneDrive</div>\r\n                                    </div>\r\n                                    <span style={{ marginLeft: 'auto', color: 'var(--modal-border)', fontSize: '1.2rem' }}>›</span>\r\n                                </button>\r\n\r\n                                {/* Shared with Me */}\r\n                                <button onClick={openSharedWithMe} style={{\r\n                                    display: 'flex', alignItems: 'center', gap: '1rem',\r\n                                    padding: '1rem 1.25rem', background: 'var(--sharepoint-header-bg)',\r\n                                    border: '1px solid var(--modal-border)', borderRadius: '10px',\r\n                                    cursor: 'pointer', textAlign: 'left', width: '100%',\r\n                                    transition: 'all 0.15s'\r\n                                }}\r\n                                    onMouseEnter={e => { e.currentTarget.style.background = 'var(--sharepoint-item-selected)'; e.currentTarget.style.borderColor = 'var(--sharepoint-breadcrumb-text)'; }}\r\n                                    onMouseLeave={e => { e.currentTarget.style.background = 'var(--sharepoint-header-bg)'; e.currentTarget.style.borderColor = 'var(--modal-border)'; }}\r\n                                >\r\n                                    <div style={{ width: '40px', height: '40px', borderRadius: '8px', background: 'var(--ms-purple)', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>\r\n                                        <svg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"white\"><path d=\"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z\" /></svg>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div style={{ color: 'var(--modal-text-primary)', fontWeight: '600', fontSize: '0.95rem' }}>Shared with Me</div>\r\n                                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem' }}>Files others have shared with you</div>\r\n                                    </div>\r\n                                    <span style={{ marginLeft: 'auto', color: 'var(--modal-border)', fontSize: '1.2rem' }}>›</span>\r\n                                </button>\r\n\r\n                                {/* SharePoint Sites */}\r\n                                <button onClick={openSites} style={{\r\n                                    display: 'flex', alignItems: 'center', gap: '1rem',\r\n                                    padding: '1rem 1.25rem', background: 'var(--sharepoint-header-bg)',\r\n                                    border: '1px solid var(--modal-border)', borderRadius: '10px',\r\n                                    cursor: 'pointer', textAlign: 'left', width: '100%',\r\n                                    transition: 'all 0.15s'\r\n                                }}\r\n                                    onMouseEnter={e => { e.currentTarget.style.background = 'var(--sharepoint-item-selected)'; e.currentTarget.style.borderColor = 'var(--sharepoint-breadcrumb-text)'; }}\r\n                                    onMouseLeave={e => { e.currentTarget.style.background = 'var(--sharepoint-header-bg)'; e.currentTarget.style.borderColor = 'var(--modal-border)'; }}\r\n                                >\r\n                                    <div style={{ width: '40px', height: '40px', borderRadius: '8px', background: 'var(--ms-teal)', display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0 }}>\r\n                                        <svg width=\"22\" height=\"22\" viewBox=\"0 0 24 24\" fill=\"white\"><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z\" /></svg>\r\n                                    </div>\r\n                                    <div>\r\n                                        <div style={{ color: 'var(--modal-text-primary)', fontWeight: '600', fontSize: '0.95rem' }}>SharePoint Sites</div>\r\n                                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem' }}>Browse team sites and document libraries</div>\r\n                                    </div>\r\n                                    <span style={{ marginLeft: 'auto', color: 'var(--modal-border)', fontSize: '1.2rem' }}>›</span>\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Loading */}\r\n                        {loading && (\r\n                            <div style={{\r\n                                display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                height: '200px', color: 'var(--modal-text-secondary)'\r\n                            }}>\r\n                                <span>Loading...</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* SITES LIST VIEW */}\r\n                        {browseSource === 'sites' && !loading && sites.map(site => (\r\n                            <div\r\n                                key={site.id}\r\n                                onClick={() => openSiteDrives(site)}\r\n                                style={{\r\n                                    display: 'flex', alignItems: 'center',\r\n                                    padding: '0.7rem 1.25rem', cursor: 'pointer',\r\n                                    background: 'transparent', gap: '0.75rem',\r\n                                    transition: 'background 0.1s',\r\n                                    borderLeft: '3px solid transparent'\r\n                                }}\r\n                                onMouseEnter={e => e.currentTarget.style.background = 'var(--modal-item-hover)'}\r\n                                onMouseLeave={e => e.currentTarget.style.background = 'transparent'}\r\n                            >\r\n                                <div style={{ width: '28px', textAlign: 'center', flexShrink: 0 }}>\r\n                                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                        <path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z\" fill=\"var(--ms-teal)\" />\r\n                                        <text x=\"12\" y=\"16\" textAnchor=\"middle\" fill=\"white\" fontSize=\"12\" fontWeight=\"bold\">S</text>\r\n                                    </svg>\r\n                                </div>\r\n                                <div style={{ flex: 1, minWidth: 0 }}>\r\n                                    <div style={{ color: 'var(--modal-text-primary)', fontSize: '0.9rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                                        {site.displayName}\r\n                                    </div>\r\n                                    {site.webUrl && (\r\n                                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.75rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                                            {site.webUrl}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                <span style={{ color: 'var(--modal-border)', fontSize: '1.1rem' }}>›</span>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {/* SITE DRIVES LIST VIEW */}\r\n                        {browseSource === 'site-drives' && !loading && drives.map(drive => (\r\n                            <div\r\n                                key={drive.id}\r\n                                onClick={() => openDrive(drive)}\r\n                                style={{\r\n                                    display: 'flex', alignItems: 'center',\r\n                                    padding: '0.7rem 1.25rem', cursor: 'pointer',\r\n                                    background: 'transparent', gap: '0.75rem',\r\n                                    transition: 'background 0.1s',\r\n                                    borderLeft: '3px solid transparent'\r\n                                }}\r\n                                onMouseEnter={e => e.currentTarget.style.background = 'var(--modal-item-hover)'}\r\n                                onMouseLeave={e => e.currentTarget.style.background = 'transparent'}\r\n                            >\r\n                                <div style={{ width: '28px', textAlign: 'center', flexShrink: 0 }}>\r\n                                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                        <path d=\"M10 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V8C22 6.9 21.1 6 20 6H12L10 4Z\" fill=\"var(--ms-blue)\" />\r\n                                    </svg>\r\n                                </div>\r\n                                <div style={{ flex: 1, minWidth: 0 }}>\r\n                                    <div style={{ color: 'var(--modal-text-primary)', fontSize: '0.9rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                                        {drive.name}\r\n                                    </div>\r\n                                    {drive.description && (\r\n                                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.75rem', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                                            {drive.description}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                <span style={{ color: 'var(--modal-border)', fontSize: '1.1rem' }}>›</span>\r\n                            </div>\r\n                        ))}\r\n\r\n                        {/* FILE/FOLDER LIST VIEW (myfiles, shared, drive-browse) */}\r\n                        {(browseSource === 'myfiles' || browseSource === 'shared' || browseSource === 'drive-browse') && !loading && items.length === 0 && !error && (\r\n                            <div style={{\r\n                                display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                height: '200px', color: 'var(--modal-text-secondary)', fontSize: '0.9rem'\r\n                            }}>\r\n                                No video files or folders found here.\r\n                            </div>\r\n                        )}\r\n\r\n                        {(browseSource === 'myfiles' || browseSource === 'shared' || browseSource === 'drive-browse') && !loading && items.map(item => (\r\n                            <div\r\n                                key={item.id}\r\n                                onClick={() => {\r\n                                    if (item.folder || item.remoteItem?.folder) {\r\n                                        navigateToFolder(item);\r\n                                    } else {\r\n                                        setSelectedItem(selectedItem?.id === item.id ? null : item);\r\n                                    }\r\n                                }}\r\n                                onDoubleClick={() => {\r\n                                    if (!item.folder && !item.remoteItem?.folder) selectFile(item);\r\n                                }}\r\n                                style={{\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    padding: '0.6rem 1.25rem',\r\n                                    cursor: 'pointer',\r\n                                    background: selectedItem?.id === item.id ? 'var(--modal-item-selected)' : 'transparent',\r\n                                    borderLeft: selectedItem?.id === item.id ? '3px solid var(--primary)' : '3px solid transparent',\r\n                                    transition: 'background 0.1s',\r\n                                    gap: '0.75rem'\r\n                                }}\r\n                                onMouseEnter={(e) => {\r\n                                    if (selectedItem?.id !== item.id) e.currentTarget.style.background = 'var(--modal-item-hover)';\r\n                                }}\r\n                                onMouseLeave={(e) => {\r\n                                    if (selectedItem?.id !== item.id) e.currentTarget.style.background = 'transparent';\r\n                                }}\r\n                            >\r\n                                {/* Icon */}\r\n                                <div style={{ width: '28px', textAlign: 'center', flexShrink: 0 }}>\r\n                                    {(item.folder || item.remoteItem?.folder) ? (\r\n                                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                            <path d=\"M10 4H4C2.9 4 2 4.9 2 6V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V8C22 6.9 21.1 6 20 6H12L10 4Z\" fill=\"var(--folder-yellow)\" />\r\n                                        </svg>\r\n                                    ) : (\r\n                                        <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\r\n                                            <rect x=\"3\" y=\"4\" width=\"18\" height=\"16\" rx=\"2\" fill=\"var(--video-red)\" />\r\n                                            <polygon points=\"10,8 10,16 16,12\" fill=\"white\" />\r\n                                        </svg>\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Name */}\r\n                                <div style={{ flex: 1, minWidth: 0 }}>\r\n                                    <div style={{\r\n                                        color: 'var(--modal-text-primary)', fontSize: '0.9rem',\r\n                                        whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis'\r\n                                    }}>\r\n                                        {item.name}\r\n                                    </div>\r\n                                </div>\r\n\r\n                                {/* Size */}\r\n                                <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem', minWidth: '70px', textAlign: 'right' }}>\r\n                                    {(item.folder || item.remoteItem?.folder) ? `${(item.folder?.childCount ?? item.remoteItem?.folder?.childCount ?? 0)} items` : formatSize(item.size)}\r\n                                </div>\r\n\r\n                                {/* Date */}\r\n                                <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem', minWidth: '90px', textAlign: 'right' }}>\r\n                                    {formatDate(item.lastModifiedDateTime)}\r\n                                </div>\r\n\r\n                                {(item.folder || item.remoteItem?.folder) && <span style={{ color: 'var(--modal-border)', fontSize: '1.1rem' }}>›</span>}\r\n                            </div>\r\n                        ))}\r\n\r\n                        {/* Empty states for sites/drives */}\r\n                        {browseSource === 'sites' && !loading && sites.length === 0 && !error && (\r\n                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '200px', color: 'var(--modal-text-secondary)', fontSize: '0.9rem' }}>\r\n                                No SharePoint sites found.\r\n                            </div>\r\n                        )}\r\n                        {browseSource === 'site-drives' && !loading && drives.length === 0 && !error && (\r\n                            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '200px', color: 'var(--modal-text-secondary)', fontSize: '0.9rem' }}>\r\n                                No document libraries found in this site.\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Error */}\r\n                    {error && (\r\n                        <div style={{\r\n                            padding: '0.5rem 1.25rem', color: 'var(--status-error)',\r\n                            fontSize: '0.85rem', background: 'var(--btn-error-bg)', opacity: 0.1\r\n                        }}>\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Footer */}\r\n                    <div style={{\r\n                        padding: '0.75rem 1.25rem',\r\n                        borderTop: '1px solid var(--modal-border)',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'space-between',\r\n                        background: 'var(--modal-footer-bg)'\r\n                    }}>\r\n                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.8rem' }}>\r\n                            {selectedItem\r\n                                ? `Selected: ${selectedItem.name} (${formatSize(selectedItem.size)})`\r\n                                : browseSource === 'home'\r\n                                    ? 'Choose a file location to browse'\r\n                                    : 'Click a video to select, double-click to open immediately'\r\n                            }\r\n                        </div>\r\n                        <div style={{ display: 'flex', gap: '0.5rem' }}>\r\n                            <button onClick={onClose} style={{\r\n                                padding: '0.5rem 1.25rem', background: 'var(--modal-border)', color: 'var(--modal-text-secondary)',\r\n                                border: 'none', borderRadius: '6px', cursor: 'pointer',\r\n                                fontSize: '0.9rem', fontWeight: '500'\r\n                            }}>Cancel</button>\r\n                            <button\r\n                                onClick={() => selectedItem && selectFile(selectedItem)}\r\n                                disabled={!selectedItem || downloading}\r\n                                style={{\r\n                                    padding: '0.5rem 1.5rem',\r\n                                    background: selectedItem && !downloading ? 'var(--ms-blue)' : 'var(--modal-border)',\r\n                                    color: selectedItem && !downloading ? 'white' : 'var(--modal-text-secondary)',\r\n                                    border: 'none', borderRadius: '6px',\r\n                                    cursor: selectedItem && !downloading ? 'pointer' : 'not-allowed',\r\n                                    fontSize: '0.9rem', fontWeight: '700'\r\n                                }}\r\n                            >\r\n                                {downloading ? 'Importing...' : 'Select'}\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Server import overlay */}\r\n            {downloading && (\r\n                <div style={{\r\n                    position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n                    backgroundColor: 'var(--modal-overlay)',\r\n                    zIndex: 10001,\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                    flexDirection: 'column', gap: '1rem'\r\n                }}>\r\n                    <div style={{\r\n                        background: 'var(--modal-bg)', padding: '2rem 3rem',\r\n                        borderRadius: '12px', textAlign: 'center',\r\n                        boxShadow: 'var(--modal-overlay)'\r\n                    }}>\r\n                        <div style={{\r\n                            width: '40px', height: '40px', margin: '0 auto 1rem',\r\n                            border: '3px solid var(--modal-border)', borderTopColor: 'var(--ms-blue)',\r\n                            borderRadius: '50%',\r\n                            animation: 'spin 1s linear infinite'\r\n                        }} />\r\n                        <div style={{ color: 'var(--modal-text-primary)', fontWeight: '600' }}>\r\n                            Importing from SharePoint...\r\n                        </div>\r\n                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.85rem', marginTop: '0.25rem' }}>\r\n                            Server is downloading the file directly — no bandwidth used on your end\r\n                        </div>\r\n                        <div style={{ color: 'var(--modal-text-secondary)', fontSize: '0.85rem', marginTop: '0.5rem' }}>\r\n                            {selectedItem?.name}\r\n                        </div>\r\n                    </div>\r\n                    <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>\r\n                </div>\r\n            )}\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2241, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/personality/components/PersonalityChooser.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useEffect } from 'react';\r\n\r\n\r\nexport type Personality = 'meetings' | 'training' | 'support';\r\n\r\ninterface PersonalityChooserProps {\r\n    onPersonalityChange: (personality: Personality) => void;\r\n    currentPersonality: Personality;\r\n}\r\n\r\nconst PERSONALITIES = [\r\n    { id: 'meetings' as Personality, label: 'Meetings', icon: '📊', description: 'Focus on action items and decisions' },\r\n    { id: 'training' as Personality, label: 'Training', icon: '🎓', description: 'Focus on learning and instructions' },\r\n    { id: 'support' as Personality, label: 'Support', icon: '🛠️', description: 'Focus on troubleshooting and Q&A' },\r\n];\r\n\r\nexport default function PersonalityChooser({ onPersonalityChange, currentPersonality }: PersonalityChooserProps) {\r\n    const [showDropdown, setShowDropdown] = useState(false);\r\n    const dropdownRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Close dropdown when clicking outside\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {\r\n                setShowDropdown(false);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => document.removeEventListener('mousedown', handleClickOutside);\r\n    }, []);\r\n\r\n    const currentPersonalityData = PERSONALITIES.find(p => p.id === currentPersonality) || PERSONALITIES[0];\r\n\r\n    return (\r\n        <div style={{ position: 'relative' }} ref={dropdownRef}>\r\n            <button\r\n                onClick={() => setShowDropdown(!showDropdown)}\r\n                style={{\r\n                    height: '36px',\r\n                    padding: '0 1rem',\r\n                    background: 'var(--header-btn-personality-bg)',\r\n                    color: 'var(--header-btn-personality-text)',\r\n                    border: 'none',\r\n                    borderRadius: '5px',\r\n                    cursor: 'pointer',\r\n                    fontSize: '0.8rem',\r\n                    fontWeight: '600',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    gap: '0.5rem',\r\n                    transition: 'background 0.2s',\r\n                    textTransform: 'uppercase',\r\n                    letterSpacing: '0.5px',\r\n                }}\r\n                onMouseEnter={(e) => e.currentTarget.style.background = 'var(--primary-hover)'}\r\n                onMouseLeave={(e) => e.currentTarget.style.background = 'var(--header-btn-personality-bg)'}\r\n            >\r\n                <span>{currentPersonalityData.icon}</span>\r\n                <span>{currentPersonalityData.label}</span>\r\n                <span style={{ fontSize: '0.7rem' }}>▼</span>\r\n            </button>\r\n\r\n            {showDropdown && (\r\n                <div style={{\r\n                    position: 'absolute',\r\n                    top: '110%',\r\n                    left: 0,\r\n                    minWidth: '250px',\r\n                    background: 'var(--header-dropdown-bg)',\r\n                    border: '1px solid var(--header-dropdown-border)',\r\n                    borderRadius: '8px',\r\n                    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n                    padding: '0.5rem',\r\n                    zIndex: 200,\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    gap: '0.25rem'\r\n                }}>\r\n                    {PERSONALITIES.map(personality => (\r\n                        <button\r\n                            key={personality.id}\r\n                            onClick={() => {\r\n                                onPersonalityChange(personality.id);\r\n                                setShowDropdown(false);\r\n                            }}\r\n                            style={{\r\n                                padding: '0.75rem 1rem',\r\n                                border: 'none',\r\n                                background: currentPersonality === personality.id ? 'var(--upload-hover-bg)' : 'transparent',\r\n                                textAlign: 'left',\r\n                                cursor: 'pointer',\r\n                                borderRadius: '4px',\r\n                                fontSize: '0.9rem',\r\n                                color: 'var(--text-primary)',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                gap: '0.75rem',\r\n                                fontWeight: currentPersonality === personality.id ? '600' : '500',\r\n                                transition: 'background 0.2s'\r\n                            }}\r\n                            onMouseEnter={e => e.currentTarget.style.background = 'var(--header-dropdown-item-hover)'}\r\n                            onMouseLeave={e => {\r\n                                if (currentPersonality !== personality.id) {\r\n                                    e.currentTarget.style.background = 'transparent';\r\n                                } else {\r\n                                    e.currentTarget.style.background = 'var(--header-dropdown-item-hover)';\r\n                                }\r\n                            }}\r\n                        >\r\n                            <span style={{ fontSize: '1.5rem' }}>{personality.icon}</span>\r\n                            <div style={{ flex: 1 }}>\r\n                                <div style={{ fontWeight: '600', marginBottom: '0.15rem' }}>\r\n                                    {personality.label}\r\n                                </div>\r\n                                <div style={{ fontSize: '0.75rem', color: 'var(--text-secondary)' }}>\r\n                                    {personality.description}\r\n                                </div>\r\n                            </div>\r\n                            {currentPersonality === personality.id && (\r\n                                <span style={{ color: 'var(--progress-fill)', fontSize: '1.2rem' }}>✓</span>\r\n                            )}\r\n                        </button>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2478, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/lib/browserStorage.ts"],"sourcesContent":["'use client';\r\n\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\n\r\n/**\r\n * Browser-side IndexedDB storage for video files.\r\n *\r\n * Each user gets their own IndexedDB database, named by email.\r\n * This ensures two users on the same browser never see each other's data.\r\n *\r\n * DB:   videoCopilot_{userEmail}   (e.g.  videoCopilot_john@contoso.com)\r\n * Store: videos\r\n * Key:   mediaId  (string – UUID)\r\n * Value: { blob: Blob, mimeType: string, fileName: string, savedAt: string }\r\n */\r\n\r\nconst DB_VERSION = 1;\r\nconst STORE_NAME = 'videos';\r\n\r\nfunction getDBName(userEmail: string): string {\r\n    // Sanitise email for IDB name (replace chars that could cause issues)\r\n    const safe = userEmail.toLowerCase().replace(/[^a-z0-9@._-]/g, '_');\r\n    return `videoCopilot_${safe}`;\r\n}\r\n\r\nfunction openDB(userEmail: string): Promise<IDBDatabase> {\r\n    return new Promise((resolve, reject) => {\r\n        const dbName = getDBName(userEmail);\r\n        const request = indexedDB.open(dbName, DB_VERSION);\r\n\r\n        request.onupgradeneeded = () => {\r\n            const db = request.result;\r\n            if (!db.objectStoreNames.contains(STORE_NAME)) {\r\n                db.createObjectStore(STORE_NAME, { keyPath: 'mediaId' });\r\n            }\r\n        };\r\n\r\n        request.onsuccess = () => resolve(request.result);\r\n        request.onerror = () => reject(request.error);\r\n    });\r\n}\r\n\r\n/** Persist a video file blob for later local playback. */\r\nexport async function saveVideoToLocal(mediaId: string, file: File, userEmail: string): Promise<void> {\r\n    if (!userEmail) {\r\n        console.warn('[BrowserStorage] No userEmail provided, skipping save.');\r\n        return;\r\n    }\r\n    try {\r\n        const db = await openDB(userEmail);\r\n        return new Promise((resolve, reject) => {\r\n            const tx = db.transaction(STORE_NAME, 'readwrite');\r\n            const store = tx.objectStore(STORE_NAME);\r\n\r\n            store.put({\r\n                mediaId,\r\n                blob: file,\r\n                mimeType: file.type || 'video/mp4',\r\n                fileName: file.name,\r\n                savedAt: new Date().toISOString(),\r\n            });\r\n\r\n            tx.oncomplete = () => {\r\n                db.close();\r\n                resolve();\r\n            };\r\n            tx.onerror = () => {\r\n                db.close();\r\n                reject(tx.error);\r\n            };\r\n        });\r\n    } catch (err) {\r\n        console.warn('[BrowserStorage] Failed to save video locally:', err);\r\n    }\r\n}\r\n\r\n/** Retrieve a video blob from local storage. Returns null if not found. */\r\nexport async function getVideoFromLocal(\r\n    mediaId: string,\r\n    userEmail: string\r\n): Promise<{ blob: Blob; mimeType: string; fileName: string } | null> {\r\n    if (!userEmail) {\r\n        console.warn('[BrowserStorage] No userEmail provided, skipping read.');\r\n        return null;\r\n    }\r\n    try {\r\n        const db = await openDB(userEmail);\r\n        return new Promise((resolve, reject) => {\r\n            const tx = db.transaction(STORE_NAME, 'readonly');\r\n            const store = tx.objectStore(STORE_NAME);\r\n            const req = store.get(mediaId);\r\n\r\n            req.onsuccess = () => {\r\n                db.close();\r\n                if (req.result) {\r\n                    resolve({\r\n                        blob: req.result.blob,\r\n                        mimeType: req.result.mimeType,\r\n                        fileName: req.result.fileName,\r\n                    });\r\n                } else {\r\n                    resolve(null);\r\n                }\r\n            };\r\n            req.onerror = () => {\r\n                db.close();\r\n                reject(req.error);\r\n            };\r\n        });\r\n    } catch (err) {\r\n        console.warn('[BrowserStorage] Failed to read video from local storage:', err);\r\n        return null;\r\n    }\r\n}\r\n\r\n/** Remove a specific video from local storage. */\r\nexport async function deleteVideoFromLocal(mediaId: string, userEmail: string): Promise<void> {\r\n    if (!userEmail) {\r\n        console.warn('[BrowserStorage] No userEmail provided, skipping delete.');\r\n        return;\r\n    }\r\n    try {\r\n        const db = await openDB(userEmail);\r\n        return new Promise((resolve, reject) => {\r\n            const tx = db.transaction(STORE_NAME, 'readwrite');\r\n            const store = tx.objectStore(STORE_NAME);\r\n            store.delete(mediaId);\r\n\r\n            tx.oncomplete = () => {\r\n                db.close();\r\n                resolve();\r\n            };\r\n            tx.onerror = () => {\r\n                db.close();\r\n                reject(tx.error);\r\n            };\r\n        });\r\n    } catch (err) {\r\n        console.warn('[BrowserStorage] Failed to delete video from local storage:', err);\r\n    }\r\n}\r\n\r\n/** \r\n * Download video from server and save to local storage.\r\n * Used for SharePoint imports or syncing across devices (if enabled).\r\n */\r\nexport async function downloadVideoFromServer(\r\n    mediaId: string,\r\n    userEmail: string,\r\n    onProgress?: (percent: number) => void\r\n): Promise<boolean> {\r\n    try {\r\n        console.log(`[BrowserStorage] Downloading video ${mediaId} from server...`);\r\n        // Use getApiPath to ensure correct base path in production\r\n        const url = getApiPath(`/api/media/${mediaId}/stream`);\r\n        const response = await fetch(url);\r\n\r\n        if (!response.ok) {\r\n            console.error(`[BrowserStorage] Download failed: ${response.status} ${response.statusText}`);\r\n            return false;\r\n        }\r\n\r\n        const blob = await response.blob();\r\n        if (blob.size < 100) {\r\n            console.error('[BrowserStorage] Downloaded blob is too small, likely an error page');\r\n            return false;\r\n        }\r\n\r\n        // Create a File object from the blob (optional, but good for metadata)\r\n        const fileName = `imported_${mediaId}.mp4`; // We might not know the original name here easily without another API call, but that's fine\r\n        const file = new File([blob], fileName, { type: blob.type || 'video/mp4' });\r\n\r\n        await saveVideoToLocal(mediaId, file, userEmail);\r\n        console.log(`[BrowserStorage] Successfully downloaded and saved video ${mediaId} to IndexedDB`);\r\n        return true;\r\n\r\n    } catch (error) {\r\n        console.error('[BrowserStorage] Error in downloadVideoFromServer:', error);\r\n        return false;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2648, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/upload/components/FileUploader.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useRef, useEffect, forwardRef, useImperativeHandle } from 'react';\r\nimport MinimalProgressBar from './MinimalProgressBar';\r\nimport { useDragDrop } from '@/hooks/useDragDrop';\r\nimport AuthButton from '@/features/auth/components/AuthButton';\r\nimport SharePointPicker from './SharePoint/SharePointPicker';\r\nimport type { ServerImportResult } from './SharePoint/SharePointPicker';\r\nimport PersonalityChooser, { Personality } from '@/features/personality/components/PersonalityChooser';\r\n\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\nimport { saveVideoToLocal } from '@/lib/browserStorage';\r\n\r\nimport { useMsal } from '@azure/msal-react';\r\n\r\nexport interface FileUploaderRef {\r\n    uploadFile: (file: File) => void;\r\n}\r\n\r\ninterface FileUploaderProps {\r\n    onUploadComplete: (mediaId: string, jobId: string) => void;\r\n    onLoadExisting?: (mediaId: string) => void;\r\n    currentJobStatus?: string;\r\n    currentJobProgress?: number;\r\n    onCancel?: () => void;\r\n    personality?: Personality; // Added for passing personality to APIs\r\n    onPersonalityChange?: (personality: Personality) => void; // Handler for personality changes\r\n}\r\n\r\ninterface HistoryItem {\r\n    mediaId: string;\r\n    jobId: string;\r\n    fileName: string;\r\n    date: string;\r\n    userEmail?: string; // Track who uploaded\r\n}\r\n\r\nconst FileUploader = forwardRef<FileUploaderRef, FileUploaderProps>(({\r\n    onUploadComplete,\r\n    onLoadExisting,\r\n    currentJobStatus,\r\n    currentJobProgress = 0,\r\n    onCancel,\r\n    personality = 'meetings', // Default to meetings\r\n    onPersonalityChange\r\n}, ref) => {\r\n    const { instance, accounts } = useMsal();\r\n    const [status, setStatus] = useState<'idle' | 'uploading' | 'queued' | 'error'>('idle');\r\n    const [uploadProgress, setUploadProgress] = useState(0);\r\n    const [message, setMessage] = useState('');\r\n    const [loadingFromHistory, setLoadingFromHistory] = useState(false);\r\n    const [activeJobId, setActiveJobId] = useState<string | null>(null);\r\n    const fileInputRef = useRef<HTMLInputElement>(null);\r\n    const xhrRef = useRef<XMLHttpRequest | null>(null);\r\n\r\n    // History State\r\n    const [history, setHistory] = useState<HistoryItem[]>([]);\r\n    const [showHistory, setShowHistory] = useState(false);\r\n\r\n    // Upload State\r\n    const [showUploadModal, setShowUploadModal] = useState(false); // Used for Dropdown now\r\n    const [showOneDriveBrowser, setShowOneDriveBrowser] = useState(false);\r\n    const [sharePointLoading, setSharePointLoading] = useState(false);\r\n    const uploadContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Popup UX State\r\n    const [isClosing, setIsClosing] = useState(false);\r\n    const popupRef = useRef<HTMLDivElement>(null);\r\n    const buttonRef = useRef<HTMLButtonElement>(null);\r\n\r\n    const closePopup = () => {\r\n        setIsClosing(true);\r\n        setTimeout(() => {\r\n            setShowHistory(false);\r\n            setIsClosing(false);\r\n        }, 1000);\r\n    };\r\n\r\n    // Click Outside Listener\r\n    useEffect(() => {\r\n        const handleClickOutside = (event: MouseEvent) => {\r\n            // Close History Popup\r\n            if (showHistory && !isClosing &&\r\n                popupRef.current && !popupRef.current.contains(event.target as Node) &&\r\n                buttonRef.current && !buttonRef.current.contains(event.target as Node)) {\r\n                closePopup();\r\n            }\r\n\r\n            // Close Upload Dropdown\r\n            if (showUploadModal &&\r\n                uploadContainerRef.current && !uploadContainerRef.current.contains(event.target as Node)) {\r\n                setShowUploadModal(false);\r\n            }\r\n        };\r\n\r\n        document.addEventListener('mousedown', handleClickOutside);\r\n        return () => {\r\n            document.removeEventListener('mousedown', handleClickOutside);\r\n        };\r\n    }, [showHistory, isClosing, showUploadModal]);\r\n\r\n    // Load history on mount and sync with server\r\n    useEffect(() => {\r\n        // 1. Initial load from localStorage for instant UI\r\n        const storageKey = `vc_history_${personality}`;\r\n        const saved = localStorage.getItem(storageKey);\r\n        if (saved) {\r\n            try {\r\n                setHistory(JSON.parse(saved));\r\n            } catch (e) {\r\n                console.error(\"Failed to parse history\", e);\r\n            }\r\n        } else {\r\n            // Clear history if nothing saved for this personality to prevent stale data\r\n            setHistory([]);\r\n        }\r\n\r\n        // 2. ALWAYS fetch fresh list/status from server to fix stuck \"Processing\" states\r\n        // Use the current user's email to filter the list\r\n        const userEmail = accounts[0]?.username;\r\n        const queryParams = new URLSearchParams({ personality });\r\n        if (userEmail) queryParams.append('userEmail', userEmail);\r\n\r\n        fetch(getApiPath(`/api/media/list?${queryParams.toString()}`))\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                if (data.videos && Array.isArray(data.videos)) {\r\n                    // Map server videos to history items\r\n                    const serverItems = data.videos.map((v: any) => ({\r\n                        mediaId: v.id,\r\n                        jobId: v.id, // Use mediaId as jobId fallback\r\n                        fileName: v.title || v.filename || 'Untitled',\r\n                        status: v.status || 'completed',\r\n                        date: new Date(v.upload_date).toLocaleDateString(),\r\n                        progress: 100\r\n                    }));\r\n\r\n                    // Update history, keeping local items if needed, but prioritizing server status\r\n                    setHistory(current => {\r\n                        // Trusting server is safer. Server knows what is really done.\r\n                        const newHistory = serverItems;\r\n                        localStorage.setItem(storageKey, JSON.stringify(newHistory));\r\n                        return newHistory;\r\n                    });\r\n                }\r\n            })\r\n            .catch(err => console.error(\"Failed to sync history\", err));\r\n    }, [personality, accounts]);\r\n\r\n    // Save history helper\r\n    const addToHistory = (item: HistoryItem) => {\r\n        setHistory(prevHistory => {\r\n            const newHistory = [item, ...prevHistory.filter(h => h.mediaId !== item.mediaId)]; // No limit - show all\r\n            const storageKey = `vc_history_${personality}`;\r\n            localStorage.setItem(storageKey, JSON.stringify(newHistory));\r\n            return newHistory;\r\n        });\r\n    };\r\n\r\n    // reset internal state when job completes\r\n    useEffect(() => {\r\n        if (currentJobStatus === 'COMPLETED') {\r\n            // eslint-disable-next-line\r\n            setStatus('idle');\r\n            setMessage('Ready');\r\n        }\r\n    }, [currentJobStatus]);\r\n\r\n    const handleCancel = async () => {\r\n        // 1. Cancel Upload\r\n        if (status === 'uploading') {\r\n            if (xhrRef.current) {\r\n                xhrRef.current.abort();\r\n                xhrRef.current = null;\r\n            }\r\n            setStatus('idle');\r\n            setMessage('Cancelled');\r\n            setUploadProgress(0);\r\n            if (onCancel) onCancel();\r\n            return;\r\n        }\r\n\r\n        // 2. Cancel Processing\r\n        if (activeJobId || (currentJobStatus && currentJobStatus !== 'COMPLETED' && currentJobStatus !== 'FAILED')) {\r\n            // Prefer internal activeJobId, fallback to what might be passed (though we don't get ID from props usually)\r\n            const jId = activeJobId;\r\n            if (jId) {\r\n                try {\r\n                    await fetch(getApiPath(`/api/job/${jId}`), { method: 'DELETE' });\r\n\r\n                    // Remove from History using the jobId\r\n                    const newHistory = history.filter(h => h.jobId !== jId);\r\n                    setHistory(newHistory);\r\n                    localStorage.setItem(`vc_history_${personality}`, JSON.stringify(newHistory));\r\n\r\n                } catch (e) {\r\n                    console.error(\"Failed to delete job\", e);\r\n                }\r\n            }\r\n\r\n            // Reset State\r\n            setStatus('idle');\r\n            setMessage('Cancelled');\r\n            setActiveJobId(null);\r\n            if (onCancel) onCancel();\r\n        }\r\n    };\r\n\r\n    const startProcessing = async (mediaId: string, fileName: string, fileId: string | null = null) => {\r\n        try {\r\n            const userEmail = accounts[0]?.username || 'anonymous';\r\n\r\n            const res = await fetch(getApiPath('/api/process'), {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    mediaId,\r\n                    personality,\r\n                    userEmail\r\n                }),\r\n            });\r\n            const data = await res.json();\r\n            if (res.ok) {\r\n                // Save to history with user tracking\r\n                addToHistory({\r\n                    mediaId,\r\n                    jobId: data.jobId,\r\n                    fileName,\r\n                    date: new Date().toISOString(),\r\n                    userEmail\r\n                });\r\n\r\n                setActiveJobId(data.jobId);\r\n                onUploadComplete(mediaId, data.jobId);\r\n            } else {\r\n                setStatus('error');\r\n                setMessage('Failed to start processing.');\r\n            }\r\n        } catch (_err) {\r\n            setStatus('error');\r\n            setMessage('Failed to connect to processing API.');\r\n        }\r\n    };\r\n\r\n    const processFile = async (file: File, fileId: string | null = null) => {\r\n        if (!file) return;\r\n\r\n        // Duplicate Check\r\n        const existing = history.find(h => h.fileName === file.name);\r\n        if (existing) {\r\n            const useExisting = window.confirm(\r\n                `You analyzed \"${file.name}\" on ${new Date(existing.date).toLocaleDateString()}.\\n\\nLoad the existing analysis instead of re-uploading?`\r\n            );\r\n\r\n            if (useExisting) {\r\n                setLoadingFromHistory(true);\r\n                if (onLoadExisting) {\r\n                    onLoadExisting(existing.mediaId);\r\n                } else {\r\n                    onUploadComplete(existing.mediaId, existing.jobId);\r\n                }\r\n                // Reset flag after a brief delay\r\n                setTimeout(() => setLoadingFromHistory(false), 500);\r\n                return;\r\n            }\r\n        }\r\n\r\n        setStatus('uploading');\r\n        setMessage(`Saving locally & uploading ${file.name}...`);\r\n        setUploadProgress(0);\r\n\r\n        try {\r\n            const xhr = new XMLHttpRequest();\r\n            xhrRef.current = xhr;\r\n            xhr.open('POST', getApiPath('/api/upload'), true);\r\n            xhr.setRequestHeader('X-Original-Filename', file.name);\r\n\r\n            xhr.upload.onprogress = (event) => {\r\n                if (event.lengthComputable) {\r\n                    const percentComplete = (event.loaded / event.total) * 100;\r\n                    setUploadProgress(percentComplete);\r\n                }\r\n            };\r\n\r\n            xhr.onload = async () => {\r\n                if (xhr.status === 200) {\r\n                    const response = JSON.parse(xhr.responseText);\r\n                    setStatus('queued');\r\n                    setMessage('Queuing for processing...');\r\n\r\n                    // Save video blob to IndexedDB with the real mediaId\r\n                    try {\r\n                        await saveVideoToLocal(response.mediaId, file, accounts[0]?.username || 'anonymous');\r\n                        console.log(`[FileUploader] Saved ${file.name} to IndexedDB for ${accounts[0]?.username} (${response.mediaId})`);\r\n                    } catch (idbErr) {\r\n                        console.warn('[FileUploader] Failed to save video locally:', idbErr);\r\n                    }\r\n\r\n                    // Start the job\r\n                    await startProcessing(response.mediaId, file.name, fileId);\r\n                } else {\r\n                    setStatus('error');\r\n                    setMessage('Upload failed.');\r\n                }\r\n            };\r\n\r\n            xhr.onerror = () => {\r\n                setStatus('error');\r\n                setMessage('Network error during upload.');\r\n            };\r\n\r\n            xhr.send(file);\r\n        } catch (err) {\r\n            console.error(err);\r\n            setStatus('error');\r\n            setMessage('Upload failed.');\r\n        }\r\n    };\r\n\r\n\r\n\r\n    // OneDrive file browser - opens the Graph API modal\r\n    const openSharePointPicker = () => {\r\n        if (!accounts[0]) {\r\n            alert('Please sign in with Microsoft first');\r\n            return;\r\n        }\r\n        setShowOneDriveBrowser(true);\r\n    };\r\n\r\n    // Expose uploadFile method via Ref\r\n    useImperativeHandle(ref, () => ({\r\n        uploadFile: (file: File) => {\r\n            processFile(file);\r\n        }\r\n    }));\r\n\r\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const files = Array.from(e.target.files || []);\r\n        if (files.length === 0) return;\r\n\r\n        console.log(`📦 Batch upload: ${files.length} file(s) selected`);\r\n\r\n        // Process files sequentially\r\n        for (let i = 0; i < files.length; i++) {\r\n            const file = files[i];\r\n            console.log(`Processing file ${i + 1}/${files.length}: ${file.name}`);\r\n\r\n            // Update message to show batch progress with time estimate\r\n            if (files.length > 1) {\r\n                const avgTimePerVideo = 15; // minutes per video\r\n                const remainingFiles = files.length - i;\r\n                const estimatedMinutes = Math.round(remainingFiles * avgTimePerVideo);\r\n                setMessage(`Batch: ${i + 1}/${files.length} - ${file.name} (~${estimatedMinutes} min remaining)`);\r\n            }\r\n\r\n            await processFile(file);\r\n\r\n            // Small delay between files to prevent overwhelming the system\r\n            if (i < files.length - 1) {\r\n                await new Promise(resolve => setTimeout(resolve, 1000));\r\n            }\r\n        }\r\n\r\n        // Reset input value\r\n        e.target.value = '';\r\n\r\n        if (files.length > 1) {\r\n            setMessage(`✅ All ${files.length} files queued! Check Recent Media.`);\r\n            console.log(`✅ All ${files.length} files queued successfully`);\r\n            setTimeout(() => { setMessage(''); setStatus('idle'); }, 3000);\r\n        }\r\n    };\r\n\r\n    // Drag and Drop Hook\r\n    const { isDragging, dragHandlers } = useDragDrop(processFile);\r\n\r\n    // Determine what to display\r\n    const isUploading = status === 'uploading';\r\n    const isProcessing =\r\n        !loadingFromHistory && ( // Block processing UI when loading from history\r\n            status === 'queued' ||\r\n            (!!currentJobStatus &&\r\n                currentJobStatus !== 'COMPLETED' &&\r\n                currentJobStatus !== 'FAILED' &&\r\n                currentJobStatus !== '')\r\n        );\r\n\r\n\r\n    // Calculate continuous progress across both stages\r\n    // Upload: 0-20%, Processing: 20-100%\r\n    const displayProgress = isUploading\r\n        ? (uploadProgress * 0.20) // Map upload 0-100% to 0-20%\r\n        : (20 + (currentJobProgress * 0.80)); // Map processing 0-100% to 20-100%\r\n\r\n\r\n    return (\r\n        <div style={{ position: 'relative', zIndex: 10 }}>\r\n            <div className=\"header\" style={{\r\n                background: 'var(--upload-box)',\r\n                color: 'white',\r\n                borderBottom: `1px solid var(--upload-box-border)`,\r\n                padding: '0.4rem 1.5rem',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '1.5rem',\r\n                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',\r\n                height: '60px',\r\n                position: 'relative'\r\n            }}>\r\n                {/* Logo / Title Area */}\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: '0.4rem', minWidth: '250px' }}>\r\n                    {/* New Logo */}\r\n                    {/* eslint-disable-next-line @next/next/no-img-element */}\r\n                    <img\r\n                        src={getApiPath('/GetITDoneLogo.png')}\r\n                        alt=\"Get IT Done\"\r\n                        style={{\r\n                            height: '38px',\r\n                            width: 'auto',\r\n                            display: 'block'\r\n                        }}\r\n                    />\r\n                    {/* Brand Name */}\r\n                    <div style={{ display: 'flex', alignItems: 'baseline', gap: '0.4rem' }}>\r\n                        <span style={{\r\n                            fontSize: '1.5rem',\r\n                            fontWeight: '600',\r\n                            fontFamily: '\"Noto Sans\", sans-serif',\r\n                            color: 'var(--header-logo-text)',\r\n                            letterSpacing: '0.5px'\r\n                        }}>\r\n                            DrCloudEHR\r\n                        </span>\r\n                        <span style={{\r\n                            fontSize: '2.2rem',\r\n                            fontWeight: '700',\r\n                            fontFamily: '\"Bebas Neue\", sans-serif',\r\n                            color: 'var(--header-brand-text)',\r\n                            fontStyle: 'normal'\r\n                        }}>\r\n                            GetThingsDone\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Central Status Area */}\r\n                <div style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: '0.4rem', justifyContent: 'center' }}>\r\n                    <div style={{ opacity: 0.7, fontSize: '0.85rem', textAlign: 'center' }}>\r\n                        {message || ((isUploading || isProcessing) ? 'Processing...' : 'Ready for new media')}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Action Area */}\r\n                <div style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                    {/* 0. PERSONALITY Button (Before UPLOAD) */}\r\n                    {onPersonalityChange && (\r\n                        <PersonalityChooser\r\n                            onPersonalityChange={onPersonalityChange}\r\n                            currentPersonality={personality}\r\n                        />\r\n                    )}\r\n\r\n                    {/* 1. UPLOAD Button (First) */}\r\n                    <div style={{ position: 'relative' }} ref={uploadContainerRef}>\r\n                        <button\r\n                            {...dragHandlers}\r\n                            onClick={() => {\r\n                                if (isUploading || isProcessing) {\r\n                                    handleCancel();\r\n                                } else {\r\n                                    setShowUploadModal(!showUploadModal);\r\n                                }\r\n                            }}\r\n                            disabled={sharePointLoading}\r\n                            style={{\r\n                                height: '36px',\r\n                                padding: '0 1.25rem',\r\n                                background: (isUploading || isProcessing) ? 'var(--btn-error-bg)' : (sharePointLoading ? 'var(--text-light)' : 'var(--header-btn-upload-bg)'),\r\n                                color: 'var(--header-btn-upload-text)',\r\n                                border: 'none',\r\n                                borderRadius: '8px',\r\n                                cursor: sharePointLoading ? 'not-allowed' : 'pointer',\r\n                                fontSize: '0.8rem',\r\n                                fontWeight: '600',\r\n                                transition: 'all 0.2s',\r\n                                textTransform: 'uppercase',\r\n                                letterSpacing: '0.5px',\r\n                                display: 'flex',\r\n                                alignItems: 'center'\r\n                            }}\r\n                            onMouseEnter={(e) => {\r\n                                if (isUploading || isProcessing) {\r\n                                    e.currentTarget.style.background = 'var(--btn-error-hover)';\r\n                                } else if (!sharePointLoading) {\r\n                                    e.currentTarget.style.background = 'var(--primary-hover)';\r\n                                }\r\n                            }}\r\n                            onMouseLeave={(e) => {\r\n                                if (isUploading || isProcessing) {\r\n                                    e.currentTarget.style.background = 'var(--btn-error-bg)';\r\n                                } else if (!sharePointLoading) {\r\n                                    e.currentTarget.style.background = 'var(--header-btn-upload-bg)';\r\n                                }\r\n                            }}\r\n                        >\r\n                            {(isUploading || isProcessing) ? 'CANCEL' : (sharePointLoading ? 'Opening...' : 'UPLOAD')}\r\n                        </button>\r\n\r\n                        {/* Upload Dropdown */}\r\n                        {showUploadModal && (\r\n                            <div style={{\r\n                                position: 'absolute',\r\n                                top: '110%',\r\n                                left: 0,\r\n                                width: '200px',\r\n                                background: 'var(--header-dropdown-bg)',\r\n                                border: '1px solid var(--header-dropdown-border)',\r\n                                borderRadius: '8px',\r\n                                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n                                padding: '0.5rem',\r\n                                zIndex: 200,\r\n                                display: 'flex',\r\n                                flexDirection: 'column',\r\n                                gap: '0.25rem'\r\n                            }}>\r\n                                <button\r\n                                    onClick={() => {\r\n                                        fileInputRef.current?.click();\r\n                                        setShowUploadModal(false);\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '0.75rem 1rem',\r\n                                        border: 'none',\r\n                                        background: 'transparent',\r\n                                        textAlign: 'left',\r\n                                        cursor: 'pointer',\r\n                                        borderRadius: '4px',\r\n                                        fontSize: '0.9rem',\r\n                                        color: 'var(--text-primary)',\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        gap: '0.75rem',\r\n                                        fontWeight: '500'\r\n                                    }}\r\n                                    onMouseEnter={e => e.currentTarget.style.background = 'var(--header-dropdown-item-hover)'}\r\n                                    onMouseLeave={e => e.currentTarget.style.background = 'transparent'}\r\n                                >\r\n                                    💻 Computer\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => {\r\n                                        setShowUploadModal(false);\r\n                                        openSharePointPicker();\r\n                                    }}\r\n                                    style={{\r\n                                        padding: '0.75rem 1rem',\r\n                                        border: 'none',\r\n                                        background: 'transparent',\r\n                                        textAlign: 'left',\r\n                                        cursor: 'pointer',\r\n                                        borderRadius: '4px',\r\n                                        fontSize: '0.9rem',\r\n                                        color: 'var(--text-primary)',\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        gap: '0.75rem',\r\n                                        fontWeight: '500'\r\n                                    }}\r\n                                    onMouseEnter={e => e.currentTarget.style.background = 'var(--header-dropdown-item-hover)'}\r\n                                    onMouseLeave={e => e.currentTarget.style.background = 'transparent'}\r\n                                >\r\n                                    ☁️ SharePoint\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* 2. Recent Media Icon Button (Second) */}\r\n                    <div style={{ position: 'relative' }}>\r\n                        <button\r\n                            ref={buttonRef}\r\n                            onClick={() => {\r\n                                if (showHistory && !isClosing) {\r\n                                    closePopup();\r\n                                } else if (!showHistory) {\r\n                                    setShowHistory(true);\r\n                                }\r\n                            }}\r\n                            style={{\r\n                                height: '36px',\r\n                                padding: '0 1rem',\r\n                                background: 'var(--header-btn-history-bg)',\r\n                                color: 'var(--header-btn-history-text)',\r\n                                border: 'none',\r\n                                borderRadius: '8px',\r\n                                cursor: 'pointer',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                transition: 'background 0.2s'\r\n                            }}\r\n                            onMouseEnter={(e) => {\r\n                                e.currentTarget.style.background = 'var(--primary-hover)';\r\n                            }}\r\n                            onMouseLeave={(e) => {\r\n                                e.currentTarget.style.background = 'var(--header-btn-history-bg)';\r\n                            }}\r\n                            title=\"Recent Media\"\r\n                        >\r\n                            {/* Folder with Clock Icon (Scaled) */}\r\n                            <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                <path d=\"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z\"></path>\r\n                                <circle cx=\"12\" cy=\"13\" r=\"3\"></circle>\r\n                                <path d=\"M12 10v3l1.5 1.5\"></path>\r\n                            </svg>\r\n                        </button>\r\n\r\n                        {/* Popup */}\r\n                        {(showHistory || isClosing) && (\r\n                            <div\r\n                                ref={popupRef}\r\n                                style={{\r\n                                    position: 'absolute',\r\n                                    top: '110%',\r\n                                    right: 0,\r\n                                    width: '300px',\r\n                                    background: 'var(--header-dropdown-bg)',\r\n                                    border: '1px solid var(--header-dropdown-border)',\r\n                                    borderRadius: '8px',\r\n                                    boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n                                    padding: '1rem',\r\n                                    zIndex: 200,\r\n                                    opacity: isClosing ? 0 : 1,\r\n                                    color: 'var(--text-primary)',\r\n                                    transition: 'opacity .5s ease-out',\r\n                                    pointerEvents: isClosing ? 'none' : 'auto'\r\n                                }}>\r\n                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem' }}>\r\n                                    <h4 style={{ margin: 0, fontSize: '1rem' }}>Recent Media</h4>\r\n                                    {history.length > 0 && (\r\n                                        <button\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                if (window.confirm('Clear all saved media history?')) {\r\n                                                    setHistory([]);\r\n                                                    localStorage.removeItem(`vc_history_${personality}`);\r\n                                                }\r\n                                            }}\r\n                                            style={{\r\n                                                padding: '0.3rem 0.6rem',\r\n                                                fontSize: '0.75rem',\r\n                                                background: 'var(--btn-error-bg)',\r\n                                                color: 'white',\r\n                                                border: 'none',\r\n                                                borderRadius: '4px',\r\n                                                cursor: 'pointer',\r\n                                                fontWeight: '600'\r\n                                            }}\r\n                                        >\r\n                                            Clear All\r\n                                        </button>\r\n                                    )}\r\n                                </div>\r\n                                {history.length === 0 ? (\r\n                                    <p style={{ fontSize: '0.9rem', color: 'var(--text-secondary)' }}>No saved media yet.</p>\r\n                                ) : (\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem', maxHeight: '400px', overflowY: 'auto', paddingRight: '0.5rem' }}>\r\n                                        {history.map((item, i) => (\r\n                                            <div\r\n                                                key={i}\r\n                                                style={{\r\n                                                    padding: '0.5rem',\r\n                                                    border: '1px solid var(--header-dropdown-border)',\r\n                                                    borderRadius: '4px',\r\n                                                    fontSize: '0.9rem',\r\n                                                    transition: 'background 0.2s',\r\n                                                    display: 'flex',\r\n                                                    alignItems: 'center',\r\n                                                    justifyContent: 'space-between',\r\n                                                    gap: '0.5rem'\r\n                                                }}\r\n                                                onMouseEnter={e => e.currentTarget.style.background = 'var(--header-dropdown-item-hover)'}\r\n                                                onMouseLeave={e => e.currentTarget.style.background = 'var(--header-dropdown-bg)'}\r\n                                            >\r\n                                                <div\r\n                                                    onClick={() => {\r\n                                                        setLoadingFromHistory(true);\r\n                                                        setStatus('idle');\r\n                                                        if (onLoadExisting) {\r\n                                                            onLoadExisting(item.mediaId);\r\n                                                        } else {\r\n                                                            onUploadComplete(item.mediaId, item.jobId);\r\n                                                        }\r\n                                                        setShowHistory(false);\r\n                                                        setTimeout(() => setLoadingFromHistory(false), 500);\r\n                                                    }}\r\n                                                    style={{ flex: 1, cursor: 'pointer', overflow: 'hidden' }}\r\n                                                >\r\n                                                    <div style={{ fontWeight: 600, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', color: 'var(--text-primary)' }}>\r\n                                                        {item.fileName}\r\n                                                    </div>\r\n                                                    <div style={{ fontSize: '0.75rem', color: 'var(--text-secondary)' }}>\r\n                                                        {new Date(item.date).toLocaleDateString()}\r\n                                                    </div>\r\n                                                </div>\r\n\r\n                                                <button\r\n                                                    onClick={(e) => {\r\n                                                        e.stopPropagation();\r\n                                                        if (window.confirm(`Remove \"${item.fileName}\" from history?`)) {\r\n                                                            const newHistory = history.filter((_, index) => index !== i);\r\n                                                            setHistory(newHistory);\r\n                                                            localStorage.setItem(`vc_history_${personality}`, JSON.stringify(newHistory));\r\n                                                        }\r\n                                                    }}\r\n                                                    style={{\r\n                                                        background: 'none',\r\n                                                        border: 'none',\r\n                                                        cursor: 'pointer',\r\n                                                        color: 'var(--text-secondary)',\r\n                                                        padding: '4px',\r\n                                                        borderRadius: '4px',\r\n                                                        display: 'flex',\r\n                                                        alignItems: 'center',\r\n                                                        justifyContent: 'center'\r\n                                                    }}\r\n                                                    onMouseEnter={e => {\r\n                                                        e.currentTarget.style.color = 'white';\r\n                                                        e.currentTarget.style.background = 'var(--status-error)';\r\n                                                    }}\r\n                                                    onMouseLeave={e => {\r\n                                                        e.currentTarget.style.color = 'var(--text-secondary)';\r\n                                                        e.currentTarget.style.background = 'none';\r\n                                                    }}\r\n                                                    title=\"Delete\"\r\n                                                >\r\n                                                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                                        <path d=\"M3 6h18\"></path>\r\n                                                        <path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"></path>\r\n                                                        <path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"></path>\r\n                                                    </svg>\r\n                                                </button>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    <input\r\n                        type=\"file\"\r\n                        accept=\"video/*,audio/*,.mkv\"\r\n                        multiple\r\n                        ref={fileInputRef}\r\n                        onChange={handleFileChange}\r\n                        style={{ display: 'none' }}\r\n                    />\r\n\r\n                    {/* 3. LOGIN Button (Third) */}\r\n                    <AuthButton />\r\n                </div>\r\n\r\n                {/* Progress Bar - Absolutely positioned at bottom of header */}\r\n                {(isUploading || isProcessing) && (\r\n                    <div style={{\r\n                        position: 'absolute',\r\n                        bottom: -1,\r\n                        left: 0,\r\n                        right: 0,\r\n                        height: '6px',\r\n                        backgroundColor: 'var(--progress-bg)',\r\n                        overflow: 'hidden'\r\n                    }}>\r\n                        <div style={{\r\n                            position: 'absolute',\r\n                            left: 0,\r\n                            top: 0,\r\n                            height: '100%',\r\n                            width: `${Math.min(displayProgress, 100)}%`,\r\n                            backgroundColor: 'var(--progress-fill)',\r\n                            transition: 'width 2s ease-in-out'\r\n                        }} />\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Helper Text - Outside header, directly below */}\r\n            {(isUploading || isProcessing) && (\r\n                <div style={{\r\n                    width: '100%',\r\n                    backgroundColor: 'transparent',\r\n                    paddingTop: '0.5rem',\r\n                    paddingBottom: '0.5rem',\r\n                    fontSize: '12px',\r\n                    color: 'var(--text-light)',\r\n                    textAlign: 'center',\r\n                    fontWeight: '500'\r\n                }}>\r\n                    {message || (\r\n                        isUploading ? 'Uploading File' :\r\n                            (currentJobStatus === 'QUEUED' || currentJobStatus === 'PREPARING' || currentJobStatus === 'EXTRACTING_AUDIO' ||\r\n                                currentJobStatus === 'COMPRESSING_VIDEO' || currentJobStatus === 'CHUNKING' || currentJobStatus === 'TRANSCRIBING' ||\r\n                                currentJobStatus === 'TRANSCRIBING_CHUNK') ? 'Processing File' :\r\n                                'Generating Content'\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* OneDrive File Browser Modal */}\r\n            <SharePointPicker\r\n                isOpen={showOneDriveBrowser}\r\n                onClose={() => setShowOneDriveBrowser(false)}\r\n                onFileSelected={(fileOrImport: File | ServerImportResult) => {\r\n                    setShowOneDriveBrowser(false);\r\n                    if ('isServerImport' in fileOrImport && fileOrImport.isServerImport) {\r\n                        // Server-side import — file already on disk, skip upload\r\n                        setStatus('queued');\r\n                        setMessage(`Imported ${fileOrImport.fileName} from SharePoint`);\r\n                        startProcessing(fileOrImport.mediaId, fileOrImport.fileName);\r\n                    } else {\r\n                        // Client-side file (fallback / local upload)\r\n                        processFile(fileOrImport as File);\r\n                    }\r\n                }}\r\n            />\r\n        </div>\r\n    );\r\n});\r\n\r\nFileUploader.displayName = 'FileUploader';\r\nexport default FileUploader;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3718, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/player/hooks/useVideoSource.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useMsal } from '@azure/msal-react';\r\nimport { getVideoFromLocal } from '@/lib/browserStorage';\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\n\r\nexport type SourceType = 'local' | 'server' | 'none';\r\n\r\nexport function useVideoSource(mediaId: string | null, jobStatus?: string) {\r\n    const { accounts } = useMsal();\r\n    const userEmail = accounts[0]?.username || '';\r\n\r\n    const [videoSrc, setVideoSrc] = useState<string | null>(null);\r\n    const [sourceType, setSourceType] = useState<SourceType>('none');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!mediaId) {\r\n            setVideoSrc(null);\r\n            setSourceType('none');\r\n            return;\r\n        }\r\n\r\n        let cancelled = false;\r\n        const blobUrlRef: { current: string | null } = { current: null };\r\n\r\n        async function resolveSource() {\r\n            setLoading(true);\r\n\r\n            // 1. Try IndexedDB (local blob)\r\n            try {\r\n                const local = await getVideoFromLocal(mediaId!, userEmail);\r\n                if (local && !cancelled) {\r\n                    const url = URL.createObjectURL(local.blob);\r\n                    blobUrlRef.current = url;\r\n                    setVideoSrc(url);\r\n                    setSourceType('local');\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n            } catch (e) {\r\n                console.warn('[useVideoSource] IndexedDB lookup failed:', e);\r\n            }\r\n\r\n            // 2. Try server stream (HEAD request to check if file exists)\r\n            try {\r\n                const resp = await fetch(getApiPath(`/api/media/${mediaId}/stream`), { method: 'HEAD' });\r\n                if (resp.ok && !cancelled) {\r\n                    setVideoSrc(getApiPath(`/api/media/${mediaId}/stream`));\r\n                    setSourceType('server');\r\n                    setLoading(false);\r\n                    return;\r\n                }\r\n            } catch (e) {\r\n                console.warn('[useVideoSource] Server stream check failed:', e);\r\n            }\r\n\r\n            // 3. Neither available\r\n            if (!cancelled) {\r\n                setVideoSrc(null);\r\n                setSourceType('none');\r\n                setLoading(false);\r\n            }\r\n        }\r\n\r\n        resolveSource();\r\n\r\n        return () => {\r\n            cancelled = true;\r\n            // Revoke blob URL to free memory\r\n            if (blobUrlRef.current) {\r\n                URL.revokeObjectURL(blobUrlRef.current);\r\n            }\r\n        };\r\n    }, [mediaId, jobStatus, userEmail]);\r\n\r\n    return { videoSrc, sourceType, loading };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;AACA;AACA;;AALA;;;;;AASO,SAAS,eAAe,OAAsB,EAAE,SAAkB;;IACrE,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,+OAAO;IAC5B,MAAM,YAAY,QAAQ,CAAC,EAAE,EAAE,YAAY;IAE3C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,sOAAQ,EAAgB;IACxD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,sOAAQ,EAAa;IACzD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,sOAAQ,EAAC;IAEvC,IAAA,uOAAS;oCAAC;YACN,IAAI,CAAC,SAAS;gBACV,YAAY;gBACZ,cAAc;gBACd;YACJ;YAEA,IAAI,YAAY;YAChB,MAAM,aAAyC;gBAAE,SAAS;YAAK;YAE/D,eAAe;gBACX,WAAW;gBAEX,gCAAgC;gBAChC,IAAI;oBACA,MAAM,QAAQ,MAAM,IAAA,iNAAiB,EAAC,SAAU;oBAChD,IAAI,SAAS,CAAC,WAAW;wBACrB,MAAM,MAAM,IAAI,eAAe,CAAC,MAAM,IAAI;wBAC1C,WAAW,OAAO,GAAG;wBACrB,YAAY;wBACZ,cAAc;wBACd,WAAW;wBACX;oBACJ;gBACJ,EAAE,OAAO,GAAG;oBACR,QAAQ,IAAI,CAAC,6CAA6C;gBAC9D;gBAEA,8DAA8D;gBAC9D,IAAI;oBACA,MAAM,OAAO,MAAM,MAAM,IAAA,+MAAU,EAAC,CAAC,WAAW,EAAE,QAAQ,OAAO,CAAC,GAAG;wBAAE,QAAQ;oBAAO;oBACtF,IAAI,KAAK,EAAE,IAAI,CAAC,WAAW;wBACvB,YAAY,IAAA,+MAAU,EAAC,CAAC,WAAW,EAAE,QAAQ,OAAO,CAAC;wBACrD,cAAc;wBACd,WAAW;wBACX;oBACJ;gBACJ,EAAE,OAAO,GAAG;oBACR,QAAQ,IAAI,CAAC,gDAAgD;gBACjE;gBAEA,uBAAuB;gBACvB,IAAI,CAAC,WAAW;oBACZ,YAAY;oBACZ,cAAc;oBACd,WAAW;gBACf;YACJ;YAEA;YAEA;4CAAO;oBACH,YAAY;oBACZ,iCAAiC;oBACjC,IAAI,WAAW,OAAO,EAAE;wBACpB,IAAI,eAAe,CAAC,WAAW,OAAO;oBAC1C;gBACJ;;QACJ;mCAAG;QAAC;QAAS;QAAW;KAAU;IAElC,OAAO;QAAE;QAAU;QAAY;IAAQ;AAC3C;GArEgB;;QACS,+OAAO"}},
    {"offset": {"line": 3822, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/player/components/VideoPlayer.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { forwardRef, useImperativeHandle, useRef } from 'react';\r\nimport { useDragDrop } from '@/hooks/useDragDrop';\r\nimport { useVideoSource } from '../hooks/useVideoSource';\r\n\r\nexport interface VideoPlayerRef {\r\n    seekTo: (time: number) => void;\r\n}\r\n\r\ninterface VideoPlayerProps {\r\n    mediaId: string | null;\r\n    jobStatus?: string;\r\n    onFileDrop?: (file: File) => void;\r\n}\r\n\r\nconst VideoPlayer = forwardRef<VideoPlayerRef, VideoPlayerProps>(({ mediaId, jobStatus, onFileDrop }, ref) => {\r\n    const videoRef = useRef<HTMLVideoElement>(null);\r\n    const { isDragging, dragHandlers } = useDragDrop(onFileDrop);\r\n    const { videoSrc, sourceType, loading } = useVideoSource(mediaId, jobStatus);\r\n\r\n    useImperativeHandle(ref, () => ({\r\n        seekTo: (time: number) => {\r\n            if (videoRef.current) {\r\n                videoRef.current.currentTime = time;\r\n                videoRef.current.play().catch(() => { });\r\n            }\r\n        }\r\n    }));\r\n\r\n    // ── No media selected ──\r\n    if (!mediaId) {\r\n        return (\r\n            <div\r\n                className=\"video-section\"\r\n                {...dragHandlers}\r\n                style={{\r\n                    ...(isDragging ? {\r\n                        border: '2px dashed var(--video-badge-local-bg)',\r\n                        background: 'var(--video-container-bg)',\r\n                        opacity: 0.8\r\n                    } : {})\r\n                }}\r\n            >\r\n                <div style={{ textAlign: 'center', opacity: 0.6, pointerEvents: 'none' }}>\r\n                    <p style={{ fontSize: '1.2rem', fontWeight: 600 }}>\r\n                        {isDragging ? 'Drop to Upload' : 'Video Player Placeholder'}\r\n                    </p>\r\n                    <p style={{ fontSize: '0.9rem' }}>\r\n                        {isDragging ? 'Release to start analysis' : 'Upload or Drop media to start playback'}\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ── Loading state ──\r\n    if (loading) {\r\n        return (\r\n            <div className=\"video-section\" style={{\r\n                background: 'var(--video-loading-overlay)',\r\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                flexDirection: 'column', gap: '0.5rem'\r\n            }}>\r\n                <div style={{\r\n                    width: '32px', height: '32px',\r\n                    border: '3px solid var(--border-light)', borderTopColor: 'var(--video-badge-local-bg)',\r\n                    borderRadius: '50%',\r\n                    animation: 'spin 1s linear infinite'\r\n                }} />\r\n                <span style={{ color: 'var(--text-white)', fontSize: '0.85rem' }}>Loading video...</span>\r\n                <style>{`@keyframes spin { to { transform: rotate(360deg); } }`}</style>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ── Video not found (no local blob, no server file) ──\r\n    if (!videoSrc) {\r\n        return (\r\n            <div className=\"video-section\" style={{\r\n                background: 'var(--video-container-bg)',\r\n                display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                flexDirection: 'column', gap: '0.75rem', padding: '2rem',\r\n                textAlign: 'center'\r\n            }}>\r\n                <div style={{ fontSize: '2rem' }}>📄</div>\r\n                <div style={{ color: 'var(--video-error-text)', fontWeight: 600 }}>\r\n                    Video not available on this device\r\n                </div>\r\n                <div style={{ color: 'var(--text-secondary)', fontSize: '0.85rem', maxWidth: '300px' }}>\r\n                    The transcript and analysis are still available below.\r\n                    To watch the video, open this page on the device where it was originally uploaded.\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // ── Playback ──\r\n    return (\r\n        <div className=\"video-section\" style={{ background: 'black' }}>\r\n            {sourceType === 'local' && (\r\n                <div style={{\r\n                    position: 'absolute', top: '8px', right: '8px',\r\n                    background: 'var(--video-badge-local-bg)', opacity: 0.8, color: '#fff',\r\n                    padding: '2px 8px', borderRadius: '4px',\r\n                    fontSize: '0.7rem', fontWeight: 600, zIndex: 10\r\n                }}>\r\n                    LOCAL\r\n                </div>\r\n            )}\r\n            <video\r\n                key={`${mediaId}-${jobStatus === 'COMPLETED' ? 'ready' : 'processing'}-${sourceType}`}\r\n                ref={videoRef}\r\n                src={videoSrc}\r\n                controls\r\n                style={{ width: '100%', height: '100%', objectFit: 'contain' }}\r\n            >\r\n                Your browser does not support the video tag.\r\n            </video>\r\n        </div>\r\n    );\r\n});\r\n\r\nVideoPlayer.displayName = 'VideoPlayer';\r\nexport default VideoPlayer;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4086, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/shared/utils/formatTime.ts"],"sourcesContent":["/**\r\n * Format seconds into MM:SS display string.\r\n * Single source of truth — replaces 4 duplicate implementations.\r\n */\r\nexport function formatTime(seconds: number): string {\r\n    const min = Math.floor(seconds / 60);\r\n    const sec = Math.floor(seconds % 60);\r\n    return `${min}:${sec < 10 ? '0' : ''}${sec}`;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,SAAS,WAAW,OAAe;IACtC,MAAM,MAAM,KAAK,KAAK,CAAC,UAAU;IACjC,MAAM,MAAM,KAAK,KAAK,CAAC,UAAU;IACjC,OAAO,GAAG,IAAI,CAAC,EAAE,MAAM,KAAK,MAAM,KAAK,KAAK;AAChD"}},
    {"offset": {"line": 4105, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/intelligence/utils/trainingFormatters.ts"],"sourcesContent":["export function formatTrainingResponse(tab: string, data: any): string {\r\n    if (!data) return \"No data available.\";\r\n\r\n    // If data is string, try to parse it\r\n    if (typeof data === 'string') {\r\n        try {\r\n            data = JSON.parse(data);\r\n        } catch {\r\n            return data; // Return as is if not JSON\r\n        }\r\n    }\r\n\r\n    if (tab === 'chat') {\r\n        let md = `### ${data.topic_identification?.topic_name || 'Analysis'}\\n\\n`;\r\n        md += `**Goal:** ${data.training_goal}\\n\\n`;\r\n        md += `**Target Audience:** ${data.topic_identification?.audience_type}\\n`;\r\n        if (data.topic_identification?.target_video_length_seconds) {\r\n            md += `**Target Length:** ${data.topic_identification.target_video_length_seconds}s\\n\\n`;\r\n        }\r\n\r\n        if (data.scope_guardrails) {\r\n            md += `### Scope & Guardrails\\n`;\r\n            md += `**Included:**\\n${data.scope_guardrails?.included?.map((i: string) => `- ${i}`).join('\\n') || 'None'}\\n\\n`;\r\n            md += `**Excluded:**\\n${data.scope_guardrails?.excluded?.map((i: string) => `- ${i}`).join('\\n') || 'None'}\\n\\n`;\r\n        }\r\n\r\n        if (data.content_readiness) {\r\n            md += `### Readiness\\n`;\r\n            md += `**Status:** ${data.content_readiness?.reusability_status}\\n`;\r\n            md += `**Reason:** ${data.content_readiness?.reason}\\n\\n`;\r\n        }\r\n\r\n        if (data.next_recording_action) {\r\n            md += `### Next Steps\\n${data.next_recording_action.what_to_record_next}\\n`;\r\n        }\r\n\r\n        if (data.sanitization_report) {\r\n            md += `### Sanitization Report\\n`;\r\n            md += `**PHI Risk:** ${data.sanitization_report.phi_risk}\\n`;\r\n            if (data.sanitization_report.detected_terms?.length) {\r\n                md += `**Detected Terms:** ${data.sanitization_report.detected_terms.join(', ')}\\n`;\r\n            }\r\n        }\r\n\r\n        return md;\r\n    }\r\n\r\n    if (tab === 'scribe') {\r\n        if (!data.steps || !Array.isArray(data.steps)) return JSON.stringify(data, null, 2);\r\n\r\n        let md = `### Build Steps\\n\\n`;\r\n        data.steps.forEach((step: any) => {\r\n            md += `**${step.n}. ${step.action}**\\n`;\r\n            if (step.ui_path && step.ui_path.length) {\r\n                md += `   *Path: ${step.ui_path.join(' > ')}*\\n`;\r\n            }\r\n            if (step.fields_edited && step.fields_edited.length) {\r\n                md += `   *Fields:* ${step.fields_edited.join(', ')}\\n`;\r\n            }\r\n            md += '\\n';\r\n        });\r\n        return md;\r\n    }\r\n\r\n    if (tab === 'voiceover') {\r\n        let md = `### Voice-Over Script\\n\\n`;\r\n        md += `**Opening:**\\n\"${data.opening}\"\\n\\n`;\r\n\r\n        md += `**Walkthrough:**\\n`;\r\n        data.step_walkthrough?.forEach((step: string) => {\r\n            md += `- \"${step}\"\\n`;\r\n        });\r\n        md += '\\n';\r\n\r\n        if (data.single_example) {\r\n            md += `**Example (${data.single_example.example_name}):**\\n\"${data.single_example.example_script}\"\\n\\n`;\r\n        }\r\n\r\n        if (data.common_mistakes?.length) {\r\n            md += `**Common Mistakes:**\\n${data.common_mistakes.map((m: string) => `- ${m}`).join('\\n')}\\n\\n`;\r\n        }\r\n\r\n        md += `**Wrap Up:**\\n\"${data.wrap_up}\"\\n`;\r\n\r\n        return md;\r\n    }\r\n\r\n    return JSON.stringify(data, null, 2);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4189, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/intelligence/hooks/useIntelligence.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\nimport { formatTrainingResponse } from '../utils/trainingFormatters';\r\nimport { Personality } from '@/features/personality/components/PersonalityChooser';\r\n\r\nexport interface CrossVideoSource {\r\n    videoId: string;\r\n    videoTitle: string;\r\n    timestamp: number;\r\n    text: string;\r\n}\r\n\r\nexport interface Message {\r\n    role: 'user' | 'assistant';\r\n    content: string;\r\n    citations?: { start: number; end: number; label: string }[];\r\n    followUps?: string[];\r\n    crossVideoSources?: CrossVideoSource[];\r\n}\r\n\r\nexport type TrainingTab = 'chat' | 'scribe' | 'voiceover';\r\n\r\nexport function useIntelligence(\r\n    mediaId: string | null,\r\n    jobId: string | null,\r\n    personality: Personality,\r\n    onStatusChange?: (status: string) => void,\r\n    onProgressChange?: (progress: number) => void\r\n) {\r\n    const [jobStatus, setJobStatus] = useState<string>('');\r\n    const [transcriptData, setTranscriptData] = useState<any>(null);\r\n    const [polling, setPolling] = useState(false);\r\n\r\n    // Chat state\r\n    const [messages, setMessages] = useState<Message[]>([]);\r\n    const [isChatting, setIsChatting] = useState(false);\r\n\r\n    // Training mode state\r\n    const [activeTrainingTab, setActiveTrainingTab] = useState<TrainingTab>('chat');\r\n    const [trainingMessages, setTrainingMessages] = useState<Record<TrainingTab, Message[]>>({\r\n        chat: [],\r\n        scribe: [],\r\n        voiceover: []\r\n    });\r\n\r\n    const generatedTabs = useRef<Set<string>>(new Set());\r\n    const currentMediaRef = useRef<string | null>(null);\r\n\r\n    // Job Polling (or direct load when jobId is null but mediaId exists)\r\n    useEffect(() => {\r\n        if (!jobId) {\r\n            if (mediaId) {\r\n                // Direct load — content already exists on server, no polling needed\r\n                setMessages([]);\r\n                setTrainingMessages({ chat: [], scribe: [], voiceover: [] });\r\n                generatedTabs.current.clear();\r\n                setPolling(false);\r\n                setJobStatus('COMPLETED');\r\n                if (onStatusChange) onStatusChange('COMPLETED');\r\n                if (onProgressChange) onProgressChange(100);\r\n                fetchTranscript(mediaId);\r\n            } else {\r\n                setTranscriptData(null);\r\n                setMessages([]);\r\n                setTrainingMessages({ chat: [], scribe: [], voiceover: [] });\r\n                setJobStatus('');\r\n                generatedTabs.current.clear();\r\n            }\r\n            return;\r\n        }\r\n\r\n        setTranscriptData(null);\r\n        setMessages([]);\r\n\r\n        let intervalId: NodeJS.Timeout;\r\n\r\n        const checkStatus = async () => {\r\n            try {\r\n                const res = await fetch(getApiPath(`/api/job/${jobId}`));\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    setJobStatus(data.status);\r\n                    if (onStatusChange) onStatusChange(data.status);\r\n                    if (onProgressChange) onProgressChange(data.progress || 0);\r\n\r\n                    if (data.status === 'COMPLETED') {\r\n                        setPolling(false);\r\n                        fetchTranscript(data.mediaId);\r\n                        clearInterval(intervalId);\r\n                    } else if (data.status === 'FAILED') {\r\n                        setPolling(false);\r\n                        clearInterval(intervalId);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error('Polling error', e);\r\n            }\r\n        };\r\n\r\n        setPolling(true);\r\n        checkStatus();\r\n        intervalId = setInterval(checkStatus, 2000);\r\n\r\n        return () => clearInterval(intervalId);\r\n    }, [jobId, mediaId]);\r\n\r\n    const fetchTranscript = async (mid: string) => {\r\n        try {\r\n            const res = await fetch(getApiPath(`/api/transcript/${mid}`));\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setTranscriptData(data);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Failed to fetch transcript\", e);\r\n        }\r\n    };\r\n\r\n    // Auto-generate content for Training mode\r\n    useEffect(() => {\r\n        if (personality !== 'training' || !transcriptData || !mediaId) return;\r\n\r\n        if (currentMediaRef.current !== mediaId) {\r\n            currentMediaRef.current = mediaId;\r\n            generatedTabs.current.clear();\r\n        }\r\n\r\n        const cacheKey = `${mediaId}-${activeTrainingTab}`;\r\n        if (generatedTabs.current.has(cacheKey)) return;\r\n        generatedTabs.current.add(cacheKey);\r\n\r\n        const autoGenerate = async () => {\r\n            setIsChatting(true);\r\n            const currentTab = activeTrainingTab;\r\n            const defaultQuestions: Record<string, string> = {\r\n                chat: 'Analyze this training video and provide a comprehensive overview.',\r\n                scribe: 'Extract all build steps from this training video.',\r\n                voiceover: 'Generate a voice-over script for this training video.'\r\n            };\r\n\r\n            try {\r\n                const res = await fetch(getApiPath('/api/training-chat'), {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({\r\n                        question: defaultQuestions[currentTab],\r\n                        activeTab: currentTab,\r\n                        transcriptSegments: transcriptData.segments\r\n                    })\r\n                });\r\n\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    const formattedContent = formatTrainingResponse(currentTab, data.trainingData || data.answer);\r\n                    const newMsg: Message = {\r\n                        role: 'assistant',\r\n                        content: formattedContent,\r\n                        citations: data.citations,\r\n                        followUps: data.followUps\r\n                    };\r\n                    setTrainingMessages(prev => ({ ...prev, [currentTab]: [newMsg] }));\r\n                } else {\r\n                    setTrainingMessages(prev => ({\r\n                        ...prev, [currentTab]: [{ role: 'assistant', content: \"Sorry, I had trouble generating content.\" }]\r\n                    }));\r\n                    generatedTabs.current.delete(cacheKey);\r\n                }\r\n            } catch (e) {\r\n                generatedTabs.current.delete(cacheKey);\r\n            } finally {\r\n                setIsChatting(false);\r\n            }\r\n        };\r\n\r\n        autoGenerate();\r\n    }, [activeTrainingTab, personality, transcriptData, mediaId]);\r\n\r\n    const sendMessage = async (text: string) => {\r\n        if (!text.trim() || !mediaId || isChatting) return;\r\n\r\n        const userMsg: Message = { role: 'user', content: text };\r\n        if (personality === 'training') {\r\n            setTrainingMessages(prev => ({ ...prev, [activeTrainingTab]: [...prev[activeTrainingTab], userMsg] }));\r\n        } else {\r\n            setMessages(prev => [...prev, userMsg]);\r\n        }\r\n\r\n        setIsChatting(true);\r\n        const currentTab = activeTrainingTab;\r\n\r\n        try {\r\n            const apiRoute = personality === 'training' ? '/api/training-chat' : '/api/chat';\r\n            const historyMsgs = personality === 'training' ? trainingMessages[currentTab] : messages;\r\n\r\n            const res = await fetch(getApiPath(apiRoute), {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    mediaId,\r\n                    question: text,\r\n                    history: historyMsgs.map(m => ({ role: m.role, content: m.content })),\r\n                    personality,\r\n                    activeTab: personality === 'training' ? currentTab : undefined,\r\n                    transcriptSegments: transcriptData?.segments\r\n                })\r\n            });\r\n\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                const content = (personality === 'training')\r\n                    ? formatTrainingResponse(currentTab, data.trainingData || data.answer)\r\n                    : data.answer;\r\n\r\n                const newMsg: Message = {\r\n                    role: 'assistant',\r\n                    content: content,\r\n                    citations: data.citations,\r\n                    followUps: data.followUps || data.suggested_questions,\r\n                    crossVideoSources: data.crossVideoSources\r\n                };\r\n\r\n                if (personality === 'training') {\r\n                    setTrainingMessages(prev => ({ ...prev, [currentTab]: [...prev[currentTab], newMsg] }));\r\n                } else {\r\n                    setMessages(prev => [...prev, newMsg]);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            console.error('Chat error', e);\r\n        } finally {\r\n            setIsChatting(false);\r\n        }\r\n    };\r\n\r\n    return {\r\n        jobStatus,\r\n        transcriptData,\r\n        polling,\r\n        messages,\r\n        isChatting,\r\n        activeTrainingTab,\r\n        setActiveTrainingTab,\r\n        trainingMessages,\r\n        sendMessage\r\n    };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4468, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/intelligence/components/IntelligencePanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef } from 'react';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport { formatTime } from '@/shared/utils/formatTime';\r\nimport { Personality } from '@/features/personality/components/PersonalityChooser';\r\nimport { useIntelligence, Message, TrainingTab, CrossVideoSource } from '../hooks/useIntelligence';\r\n\r\ninterface IntelligencePanelProps {\r\n    mediaId: string | null;\r\n    jobId: string | null;\r\n    onSeek: (time: number) => void;\r\n    onStatusChange?: (status: string) => void;\r\n    onProgressChange?: (progress: number) => void;\r\n    personality?: Personality;\r\n}\r\n\r\ninterface KeyPoint {\r\n    text: string;\r\n    timestamp?: number;\r\n}\r\n\r\nexport default function IntelligencePanel({\r\n    mediaId,\r\n    jobId,\r\n    onSeek,\r\n    onStatusChange,\r\n    onProgressChange,\r\n    personality = 'meetings'\r\n}: IntelligencePanelProps) {\r\n    const {\r\n        jobStatus,\r\n        transcriptData,\r\n        polling,\r\n        messages,\r\n        isChatting,\r\n        activeTrainingTab,\r\n        setActiveTrainingTab,\r\n        trainingMessages,\r\n        sendMessage\r\n    } = useIntelligence(mediaId, jobId, personality, onStatusChange, onProgressChange);\r\n\r\n    const [input, setInput] = useState('');\r\n    const chatEndRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (chatEndRef.current) {\r\n            chatEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n        }\r\n    }, [messages, trainingMessages, activeTrainingTab]);\r\n\r\n    const handleSendMessage = async (textOverride?: string) => {\r\n        const textToSend = textOverride || input;\r\n        if (!textToSend.trim()) return;\r\n        if (!textOverride) setInput('');\r\n        await sendMessage(textToSend);\r\n    };\r\n\r\n    const handleHighlightClick = (point: KeyPoint) => {\r\n        if (point.timestamp !== undefined) onSeek(point.timestamp);\r\n        handleSendMessage(`Check the video at ${formatTime(point.timestamp || 0)} and tell me more about: \"${point.text}\"`);\r\n    };\r\n\r\n    const getKeyPoints = (): KeyPoint[] => {\r\n        if (!transcriptData?.keyPoints) return [];\r\n        return transcriptData.keyPoints.map((kp: any) => {\r\n            if (typeof kp === 'string') return { text: kp, timestamp: 0 };\r\n            return kp;\r\n        });\r\n    };\r\n\r\n    const keyPoints = getKeyPoints();\r\n\r\n    const processContent = (text: string) => {\r\n        return text.replace(/\\[((?:\\d{1,2}:)?\\d{1,2}:\\d{2})\\]/g, (match, timeStr) => {\r\n            const parts = timeStr.split(':').map(Number);\r\n            let seconds = 0;\r\n            if (parts.length === 3) seconds = parts[0] * 3600 + parts[1] * 60 + parts[2];\r\n            else seconds = parts[0] * 60 + parts[1];\r\n            return `[${match}](#seek:${seconds})`;\r\n        });\r\n    };\r\n\r\n    const currentMessages = personality === 'training' ? trainingMessages[activeTrainingTab] : messages;\r\n\r\n    return (\r\n        <div className=\"intelligence-panel\">\r\n            <div className=\"panel-card\" style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n                <div style={{\r\n                    borderBottom: '1px solid var(--border-default)',\r\n                    background: 'var(--chat-header-bg)'\r\n                }}>\r\n                    {personality !== 'training' && (\r\n                        <div style={{ fontSize: '1.3rem', fontWeight: '700', padding: '1.5rem', margin: 0, color: 'var(--text-primary)' }}>Chat</div>\r\n                    )}\r\n\r\n                    {personality === 'training' && (\r\n                        <div style={{\r\n                            display: 'flex', gap: '0.25rem', padding: '1rem 1rem 0 1rem',\r\n                            borderBottom: '1px solid var(--border-default)', justifyContent: 'space-between'\r\n                        }}>\r\n                            {(['chat', 'scribe', 'voiceover'] as TrainingTab[]).map((tab) => (\r\n                                <button\r\n                                    key={tab}\r\n                                    onClick={() => setActiveTrainingTab(tab)}\r\n                                    style={{\r\n                                        flex: 1, padding: '0.75rem 0.5rem', border: 'none',\r\n                                        background: activeTrainingTab === tab ? 'var(--upload-hover-bg)' : 'transparent',\r\n                                        borderBottom: activeTrainingTab === tab ? '3px solid var(--primary)' : '3px solid transparent',\r\n                                        cursor: 'pointer', fontWeight: activeTrainingTab === tab ? '700' : '500',\r\n                                        color: activeTrainingTab === tab ? 'var(--primary)' : 'var(--text-secondary)',\r\n                                        fontSize: '0.95rem', borderRadius: '8px 8px 0 0', transition: 'all 0.2s', textAlign: 'center'\r\n                                    }}\r\n                                >\r\n                                    {tab === 'chat' ? 'Chat' : tab === 'scribe' ? 'Scribe Steps' : 'VoiceOver Tips'}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"content-area\" style={{ flex: 1, overflow: 'hidden', background: 'var(--chat-messages-bg)' }}>\r\n                    <div className=\"chat-container\" style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\r\n                        <div className=\"messages\" style={{ flex: 1, padding: '1.5rem', overflowY: 'auto' }}>\r\n                            {mediaId && polling && !transcriptData && (\r\n                                <div className=\"skeleton-summary\">\r\n                                    <div className=\"skeleton\" style={{ width: '30%', height: '24px', marginBottom: '1rem' }}></div>\r\n                                    <div className=\"skeleton\" style={{ width: '100%', height: '16px', marginBottom: '0.6rem' }}></div>\r\n                                    <div className=\"skeleton\" style={{ width: '92%', height: '16px', marginBottom: '0.6rem' }}></div>\r\n                                    <div className=\"skeleton\" style={{ width: '96%', height: '16px', marginBottom: '2rem' }}></div>\r\n                                    <div className=\"skeleton\" style={{ width: '40%', height: '22px', marginBottom: '1.2rem' }}></div>\r\n                                    {[...Array(3)].map((_, i) => (\r\n                                        <div key={i} className=\"skeleton\" style={{ width: '100%', height: '70px', marginBottom: '1rem', borderRadius: '12px' }}></div>\r\n                                    ))}\r\n                                    <div style={{ textAlign: 'center', marginTop: '2rem', color: 'var(--text-secondary)', fontSize: '0.9rem' }}>\r\n                                        <p>AI is analyzing your video...</p>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {transcriptData && personality === 'meetings' && (\r\n                                <div className=\"summary-section\" style={{\r\n                                    marginBottom: '2rem',\r\n                                    padding: '1.5rem',\r\n                                    background: 'var(--chat-recap-bg)',\r\n                                    borderRadius: '12px',\r\n                                    border: '1px solid var(--border-default)'\r\n                                }}>\r\n                                    <h3 style={{ fontSize: '1.2rem', marginBottom: '0.5rem', fontWeight: '700', color: 'var(--chat-recap-title)' }}>{transcriptData.title || \"Video Recap\"}</h3>\r\n                                    <p style={{ fontSize: '0.95rem', lineHeight: '1.6', marginBottom: '1.5rem', color: 'var(--chat-recap-summary)' }}>{transcriptData.summary}</p>\r\n                                    <h3 style={{ fontSize: '1.1rem', marginBottom: '0.8rem', fontWeight: '700', color: 'var(--chat-recap-title)' }}>Key Highlights</h3>\r\n                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.8rem' }}>\r\n                                        {keyPoints.map((point, idx) => (\r\n                                            <div\r\n                                                key={idx}\r\n                                                onClick={() => handleHighlightClick(point)}\r\n                                                className=\"highlight-bubble\"\r\n                                                style={{\r\n                                                    padding: '1rem', background: 'var(--highlight-card-bg)', border: '1px solid var(--highlight-card-border)',\r\n                                                    borderRadius: '12px', boxShadow: 'var(--shadow-small)',\r\n                                                    cursor: 'pointer', transition: 'all 0.2s', display: 'flex',\r\n                                                    alignItems: 'flex-start', gap: '0.8rem'\r\n                                                }}\r\n                                            >\r\n                                                <div style={{\r\n                                                    background: 'var(--highlight-number-bg)', color: 'var(--highlight-number-text)', borderRadius: '50%',\r\n                                                    width: '24px', height: '24px', display: 'flex', alignItems: 'center',\r\n                                                    justifyContent: 'center', fontSize: '0.8rem', fontWeight: 'bold', flexShrink: 0, marginTop: '2px'\r\n                                                }}>{idx + 1}</div>\r\n                                                <div>\r\n                                                    <p style={{ fontSize: '0.95rem', margin: 0, fontWeight: '500', color: 'var(--highlight-title-text)' }}>{point.text}</p>\r\n                                                    {point.timestamp !== undefined && point.timestamp > 0 && (\r\n                                                        <span style={{ fontSize: '0.8rem', color: 'var(--highlight-jump-link)', marginTop: '0.3rem', display: 'block' }}>\r\n                                                            Jump to {formatTime(point.timestamp)}\r\n                                                        </span>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n\r\n                            {currentMessages.map((m, i) => (\r\n                                <div key={i} className={`message-row ${m.role}`} style={{\r\n                                    alignSelf: m.role === 'user' ? 'flex-end' : 'flex-start'\r\n                                }}>\r\n                                    <div className=\"message-content\" style={{\r\n                                        background: m.role === 'user' ? 'var(--chat-bubble-user-bg)' : 'var(--chat-bubble-ai-bg)',\r\n                                        color: m.role === 'user' ? 'white' : 'var(--text-primary)',\r\n                                        border: m.role === 'user' ? 'none' : '1px solid var(--chat-input-border)',\r\n                                        boxShadow: m.role === 'user' ? 'none' : 'var(--shadow-small)'\r\n                                    }}>\r\n                                        {m.role === 'assistant' ? (\r\n                                            <div className=\"prose\">\r\n                                                <ReactMarkdown\r\n                                                    components={{\r\n                                                        a: ({ node, href, children, ...props }) => {\r\n                                                            if (href?.startsWith('#seek:')) {\r\n                                                                const seconds = parseFloat(href.split(':')[1]);\r\n                                                                return (\r\n                                                                    <button\r\n                                                                        onClick={(e) => { e.preventDefault(); onSeek(seconds); }}\r\n                                                                        style={{\r\n                                                                            background: 'var(--upload-hover-bg)', color: 'var(--primary)', border: '1px solid var(--border-default)',\r\n                                                                            borderRadius: '12px', padding: '2px 8px', fontSize: '0.85em',\r\n                                                                            fontWeight: '600', cursor: 'pointer', display: 'inline-block',\r\n                                                                            verticalAlign: 'middle', margin: '0 2px', textDecoration: 'none'\r\n                                                                        }}\r\n                                                                    >{children}</button>\r\n                                                                );\r\n                                                            }\r\n                                                            return <a href={href} {...props}>{children}</a>;\r\n                                                        }\r\n                                                    }}\r\n                                                >\r\n                                                    {processContent(m.content)}\r\n                                                </ReactMarkdown>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <p>{m.content}</p>\r\n                                        )}\r\n                                        {m.role === 'assistant' && m.followUps && (\r\n                                            <div style={{ marginTop: '1rem', display: 'flex', flexWrap: 'wrap', gap: '0.5rem' }}>\r\n                                                {m.followUps.map((q, idx) => (\r\n                                                    <button\r\n                                                        key={idx}\r\n                                                        onClick={() => handleSendMessage(q)}\r\n                                                        className=\"followup-btn\"\r\n                                                    >{q}</button>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n                                        {m.role === 'assistant' && m.crossVideoSources && m.crossVideoSources.length > 0 && (\r\n                                            <div style={{\r\n                                                marginTop: '0.75rem',\r\n                                                padding: '0.75rem',\r\n                                                background: 'var(--upload-hover-bg)',\r\n                                                borderRadius: '8px',\r\n                                                border: '1px solid var(--border-default)',\r\n                                                fontSize: '0.85rem'\r\n                                            }}>\r\n                                                <div style={{ fontWeight: 600, marginBottom: '0.4rem', color: 'var(--text-secondary)' }}>\r\n                                                    Referenced from other videos:\r\n                                                </div>\r\n                                                {m.crossVideoSources.map((src: CrossVideoSource, idx: number) => (\r\n                                                    <div key={idx} style={{\r\n                                                        padding: '0.3rem 0',\r\n                                                        color: 'var(--highlight-jump-link)',\r\n                                                    }}>\r\n                                                        {src.videoTitle} at {formatTime(src.timestamp)}\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                            {isChatting && <div className=\"typing-indicator\" style={{ color: 'var(--ai-typing-indicator)' }}>Thinking...</div>}\r\n                            <div ref={chatEndRef} />\r\n                        </div>\r\n\r\n                        <div className=\"chat-input-area\" style={{ background: 'var(--chat-input-area-bg)' }}>\r\n                            <input\r\n                                type=\"text\"\r\n                                value={input}\r\n                                onChange={(e) => setInput(e.target.value)}\r\n                                onKeyDown={(e) => e.key === 'Enter' && handleSendMessage()}\r\n                                placeholder=\"Type a question...\"\r\n                                disabled={!mediaId || polling || isChatting}\r\n                            />\r\n                            <button\r\n                                onClick={() => handleSendMessage()}\r\n                                disabled={!mediaId || polling || isChatting || !input.trim()}\r\n                            >\r\n                                <svg viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\" style={{ width: '18px', height: '18px' }}>\r\n                                    <line x1=\"22\" y1=\"2\" x2=\"11\" y2=\"13\"></line>\r\n                                    <polygon points=\"22 2 15 22 11 13 2 9 22 2\"></polygon>\r\n                                </svg>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <style>{`\r\n                .highlight-bubble:hover {\r\n                    transform: translateY(-2px);\r\n                    border-color: var(--highlight-jump-link) !important;\r\n                }\r\n                .followup-btn {\r\n                    background: var(--chat-bubble-ai-bg); border: 1px solid var(--chat-input-border); border-radius: 20px;\r\n                    padding: 0.5rem 1rem; fontSize: 0.85rem; color: var(--chat-recap-summary); cursor: pointer;\r\n                    transition: all 0.2s; text-align: left;\r\n                }\r\n                .followup-btn:hover {\r\n                    background: var(--transcript-segment-hover); border-color: var(--highlight-jump-link); color: var(--chat-recap-title);\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5181, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/transcript/components/TranscriptPanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\nimport { formatTime } from '@/shared/utils/formatTime';\r\n\r\ninterface TranscriptPanelProps {\r\n    mediaId: string | null;\r\n    jobId: string | null;\r\n    jobStatus: string;\r\n    onSeek: (time: number) => void;\r\n    highlightTimestamp?: number | null;\r\n    onHighlightDone?: () => void;\r\n}\r\n\r\nexport default function TranscriptPanel({ mediaId, jobId, jobStatus, onSeek, highlightTimestamp, onHighlightDone }: TranscriptPanelProps) {\r\n    const [transcriptData, setTranscriptData] = useState<any>(null);\r\n    const [polling, setPolling] = useState(false);\r\n    const [highlightedIndices, setHighlightedIndices] = useState<Set<number>>(new Set());\r\n    const segmentRefs = useRef<Map<number, HTMLDivElement>>(new Map());\r\n    const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    useEffect(() => {\r\n        if (!jobId) {\r\n            if (mediaId && jobStatus === 'COMPLETED') {\r\n                // Direct load — content already exists, no polling needed\r\n                setPolling(false);\r\n                fetchTranscript(mediaId);\r\n            } else {\r\n                setTranscriptData(null);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Reset for new job\r\n        setTranscriptData(null);\r\n\r\n        let intervalId: NodeJS.Timeout;\r\n\r\n        const checkStatus = async () => {\r\n            try {\r\n                const res = await fetch(getApiPath(`/api/job/${jobId}`));\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n\r\n                    if (data.status === 'COMPLETED') {\r\n                        setPolling(false);\r\n                        fetchTranscript(data.mediaId);\r\n                        clearInterval(intervalId);\r\n                    } else if (data.status === 'FAILED') {\r\n                        setPolling(false);\r\n                        clearInterval(intervalId);\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error('Polling error', e);\r\n            }\r\n        };\r\n\r\n        setPolling(true);\r\n        checkStatus();\r\n        intervalId = setInterval(checkStatus, 2000);\r\n\r\n        return () => clearInterval(intervalId);\r\n    }, [jobId, mediaId, jobStatus]);\r\n\r\n    const fetchTranscript = async (mid: string) => {\r\n        try {\r\n            const res = await fetch(getApiPath(`/api/transcript/${mid}`));\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setTranscriptData(data);\r\n            }\r\n        } catch (e) {\r\n            console.error(\"Failed to fetch transcript\", e);\r\n        }\r\n    };\r\n\r\n    // Handle highlight when Jump is pressed on action items\r\n    useEffect(() => {\r\n        if (highlightTimestamp == null || !transcriptData?.segments?.length) return;\r\n\r\n        const segments = transcriptData.segments;\r\n        const HIGHLIGHT_WINDOW = 15; // seconds — highlight segments within this range\r\n\r\n        // Find the segment closest to the target timestamp\r\n        let closestIdx = 0;\r\n        let closestDiff = Infinity;\r\n        for (let i = 0; i < segments.length; i++) {\r\n            const diff = Math.abs(segments[i].start - highlightTimestamp);\r\n            if (diff < closestDiff) {\r\n                closestDiff = diff;\r\n                closestIdx = i;\r\n            }\r\n        }\r\n\r\n        // Collect indices of segments within the highlight window\r\n        const indices = new Set<number>();\r\n        for (let i = 0; i < segments.length; i++) {\r\n            const segStart = segments[i].start;\r\n            if (segStart >= highlightTimestamp && segStart <= highlightTimestamp + HIGHLIGHT_WINDOW) {\r\n                indices.add(i);\r\n            }\r\n        }\r\n        // Always include the closest segment\r\n        indices.add(closestIdx);\r\n\r\n        setHighlightedIndices(indices);\r\n\r\n        // Scroll the closest segment into view\r\n        const el = segmentRefs.current.get(closestIdx);\r\n        if (el && scrollContainerRef.current) {\r\n            el.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n        }\r\n\r\n        // Remove highlight after 6 seconds\r\n        const timer = setTimeout(() => {\r\n            setHighlightedIndices(new Set());\r\n            if (onHighlightDone) onHighlightDone();\r\n        }, 6000);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [highlightTimestamp, transcriptData]);\r\n\r\n    const setSegmentRef = useCallback((index: number, el: HTMLDivElement | null) => {\r\n        if (el) {\r\n            segmentRefs.current.set(index, el);\r\n        } else {\r\n            segmentRefs.current.delete(index);\r\n        }\r\n    }, []);\r\n\r\n    const transcript = transcriptData?.segments || [];\r\n\r\n    return (\r\n        <div className=\"transcript-panel\">\r\n            <div className=\"panel-card\">\r\n                <div style={{\r\n                    backgroundColor: 'var(--surface)',\r\n                    fontSize: '1.3rem',\r\n                    fontWeight: '700',\r\n                    padding: '1.2rem',\r\n                    borderBottom: '1px solid var(--border-default)',\r\n                    margin: 0,\r\n                    color: 'var(--text-primary)'\r\n                }}>\r\n                    Transcript\r\n                </div>\r\n\r\n                <div className=\"content-area\" style={{ flex: 1, overflow: 'hidden' }}>\r\n                    <div\r\n                        ref={scrollContainerRef}\r\n                        className=\"transcript-content\"\r\n                        style={{ padding: '1rem', height: '100%', overflowY: 'auto' }}\r\n                    >\r\n                        {!mediaId && <p style={{ opacity: 0.6 }}>Upload a video to see the transcript.</p>}\r\n\r\n                        {/* Loading Skeleton for Transcript */}\r\n                        {mediaId && polling && (\r\n                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', padding: '0.5rem' }}>\r\n                                {[...Array(12)].map((_, i) => (\r\n                                    <div key={i} style={{ display: 'flex', gap: '1rem', alignItems: 'center' }}>\r\n                                        <div className=\"skeleton\" style={{ width: '45px', height: '16px' }}></div>\r\n                                        <div className=\"skeleton\" style={{ flex: 1, height: '16px', maxWidth: `${Math.random() * 30 + 60}%` }}></div>\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        )}\r\n\r\n                        {mediaId && !polling && transcript.length === 0 && jobStatus === 'COMPLETED' && <p>No speech detected.</p>}\r\n                        {mediaId && !polling && transcript.length > 0 && (\r\n                            <div>\r\n                                {transcript.map((seg: any, i: number) => {\r\n                                    const isHighlighted = highlightedIndices.has(i);\r\n                                    return (\r\n                                        <div\r\n                                            key={i}\r\n                                            ref={(el) => setSegmentRef(i, el)}\r\n                                            className=\"transcript-segment\"\r\n                                            onClick={() => onSeek(seg.start)}\r\n                                            style={{\r\n                                                background: isHighlighted ? 'var(--transcript-segment-highlight-bg)' : 'transparent',\r\n                                                borderLeft: isHighlighted ? '3px solid var(--transcript-segment-highlight-border)' : '3px solid transparent',\r\n                                                borderRadius: isHighlighted ? '4px' : '0',\r\n                                                transition: 'background 0.3s ease, border-left 0.3s ease',\r\n                                                paddingLeft: '0.5rem',\r\n                                                marginLeft: '-0.5rem',\r\n                                            }}\r\n                                        >\r\n                                            <span className=\"timestamp\">{formatTime(seg.start)}</span>\r\n                                            <span className=\"text\">{seg.text}</span>\r\n                                        </div>\r\n                                    );\r\n                                })}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5501, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/shared/design/theme.ts"],"sourcesContent":["export const theme = {\r\n    colors: {\r\n        // Core Palette (matches globals.css)\r\n        primary: 'var(--primary)',\r\n        primaryHover: 'var(--primary-hover)',\r\n        background: 'var(--background)',\r\n        surface: 'var(--surface)',\r\n        text: {\r\n            primary: 'var(--text-primary)',\r\n            secondary: 'var(--text-secondary)',\r\n            light: 'var(--text-light)',\r\n            white: 'var(--text-white)',\r\n        },\r\n        border: {\r\n            default: 'var(--border-default)',\r\n            dark: 'var(--border-dark)',\r\n            light: 'var(--border-light)',\r\n        },\r\n        status: {\r\n            success: 'var(--status-success)',\r\n            successBg: 'var(--status-success-bg)',\r\n            error: 'var(--status-error)',\r\n            active: 'var(--status-active)',\r\n        },\r\n\r\n        // Component Specific\r\n        upload: {\r\n            modalBg: 'var(--upload-modal-bg)',\r\n            hoverBg: 'var(--upload-hover-bg)',\r\n            uploadBox: 'var(--upload-box)',\r\n            uploadBoxBorder: 'var(--upload-box-border)',\r\n        },\r\n\r\n        progressBar: {\r\n            bg: 'var(--progress-bg)',\r\n            fill: 'var(--progress-fill)',\r\n        },\r\n\r\n        actionItems: {\r\n            'Decisions & Approvals': 'var(--action-decision)',\r\n            'Follow-ups & Coordination': 'var(--action-coord)',\r\n            'Implementation / Execution': 'var(--action-exec)',\r\n            'Reviews & Validation': 'var(--action-review)',\r\n            'Client Portal': 'var(--action-portal)',\r\n            'Reports': 'var(--action-badge-reports-bg)',\r\n            'Requirements': 'var(--action-badge-req-bg)',\r\n            'Appointment Types': 'var(--action-coord)',\r\n            'Service Codes': 'var(--action-decision)',\r\n            'Payers': 'var(--action-portal)',\r\n            'Users & Roles': 'var(--action-review)',\r\n            'DrFirst/EPCS': 'var(--action-exec)',\r\n            'Interface': 'var(--action-badge-reports-bg)',\r\n            'Data Migration': 'var(--action-badge-req-bg)',\r\n            'Dependencies & Blockers': 'var(--action-badge-req-bg)',\r\n            'Topics': 'var(--action-topic)',\r\n            'Key Question': 'var(--action-question)',\r\n            'Reaction': 'var(--action-reaction)',\r\n            // Fallback color\r\n            default: 'var(--action-badge-default-bg)',\r\n        }\r\n    }\r\n};\r\n\r\n/** Get the color for an action item category. Falls back to default gray. */\r\nexport const getCategoryColor = (category: string): string => {\r\n    return theme.colors.actionItems[category as keyof typeof theme.colors.actionItems] || theme.colors.actionItems.default;\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,QAAQ;IACjB,QAAQ;QACJ,qCAAqC;QACrC,SAAS;QACT,cAAc;QACd,YAAY;QACZ,SAAS;QACT,MAAM;YACF,SAAS;YACT,WAAW;YACX,OAAO;YACP,OAAO;QACX;QACA,QAAQ;YACJ,SAAS;YACT,MAAM;YACN,OAAO;QACX;QACA,QAAQ;YACJ,SAAS;YACT,WAAW;YACX,OAAO;YACP,QAAQ;QACZ;QAEA,qBAAqB;QACrB,QAAQ;YACJ,SAAS;YACT,SAAS;YACT,WAAW;YACX,iBAAiB;QACrB;QAEA,aAAa;YACT,IAAI;YACJ,MAAM;QACV;QAEA,aAAa;YACT,yBAAyB;YACzB,6BAA6B;YAC7B,8BAA8B;YAC9B,wBAAwB;YACxB,iBAAiB;YACjB,WAAW;YACX,gBAAgB;YAChB,qBAAqB;YACrB,iBAAiB;YACjB,UAAU;YACV,iBAAiB;YACjB,gBAAgB;YAChB,aAAa;YACb,kBAAkB;YAClB,2BAA2B;YAC3B,UAAU;YACV,gBAAgB;YAChB,YAAY;YACZ,iBAAiB;YACjB,SAAS;QACb;IACJ;AACJ;AAGO,MAAM,mBAAmB,CAAC;IAC7B,OAAO,MAAM,MAAM,CAAC,WAAW,CAAC,SAAkD,IAAI,MAAM,MAAM,CAAC,WAAW,CAAC,OAAO;AAC1H"}},
    {"offset": {"line": 5576, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/action-items/hooks/useActionItems.ts"],"sourcesContent":["'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\n\r\nexport interface ActionItem {\r\n    id: string;\r\n    category: string;\r\n    action_item: string;\r\n    responsible_party: string;\r\n    due_date: string;\r\n    notes?: string;\r\n    timestamp: number;\r\n}\r\n\r\nexport function useActionItems(mediaId: string | null, jobStatus: string) {\r\n    const [actionItems, setActionItems] = useState<ActionItem[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [videoTitle, setVideoTitle] = useState<string>('');\r\n    const [videoSummary, setVideoSummary] = useState<string>('');\r\n    const [regenerating, setRegenerating] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (!mediaId) {\r\n            setActionItems([]);\r\n            setLoading(false);\r\n            setError(null);\r\n            return;\r\n        }\r\n\r\n        if (jobStatus !== 'COMPLETED') {\r\n            setActionItems([]);\r\n            setError(null);\r\n            setLoading(jobStatus !== '' && jobStatus !== 'FAILED');\r\n            return;\r\n        }\r\n\r\n        setActionItems([]);\r\n        setError(null);\r\n\r\n        const fetchActionItems = async () => {\r\n            setLoading(true);\r\n            try {\r\n                const res = await fetch(getApiPath(`/api/action-items/${mediaId}`));\r\n                if (res.ok) {\r\n                    const data = await res.json();\r\n                    setActionItems(data);\r\n                    setError(null);\r\n                } else {\r\n                    setError('Failed to load action items');\r\n                }\r\n\r\n                try {\r\n                    const transcriptRes = await fetch(getApiPath(`/api/transcript/${mediaId}`));\r\n                    if (transcriptRes.ok) {\r\n                        const transcriptData = await transcriptRes.json();\r\n                        setVideoTitle(transcriptData.title || 'Meeting Recording');\r\n                        setVideoSummary(transcriptData.summary || '');\r\n                    }\r\n                } catch (err) {\r\n                    setVideoTitle('Meeting Recording');\r\n                    setVideoSummary('');\r\n                }\r\n            } catch (err) {\r\n                setError('Network error');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n\r\n        fetchActionItems();\r\n    }, [mediaId, jobStatus]);\r\n\r\n    const regenerateActionItems = async () => {\r\n        if (!mediaId) return;\r\n\r\n        setRegenerating(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const res = await fetch(getApiPath(`/api/action-items/${mediaId}/regenerate`), {\r\n                method: 'POST',\r\n            });\r\n\r\n            if (res.ok) {\r\n                const data = await res.json();\r\n                setActionItems(data);\r\n                setError(null);\r\n            } else {\r\n                const errorText = await res.text();\r\n                setError(`Failed to regenerate: ${errorText}`);\r\n            }\r\n        } catch (err) {\r\n            setError('Failed to regenerate action items');\r\n        } finally {\r\n            setRegenerating(false);\r\n        }\r\n    };\r\n\r\n    return {\r\n        actionItems,\r\n        loading,\r\n        error,\r\n        videoTitle,\r\n        videoSummary,\r\n        regenerating,\r\n        regenerateActionItems,\r\n        setActionItems\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;AAHA;;;AAeO,SAAS,eAAe,OAAsB,EAAE,SAAiB;;IACpE,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,sOAAQ,EAAe,EAAE;IAC/D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,sOAAQ,EAAC;IACvC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,sOAAQ,EAAgB;IAClD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,sOAAQ,EAAS;IACrD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,sOAAQ,EAAS;IACzD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,sOAAQ,EAAC;IAEjD,IAAA,uOAAS;oCAAC;YACN,IAAI,CAAC,SAAS;gBACV,eAAe,EAAE;gBACjB,WAAW;gBACX,SAAS;gBACT;YACJ;YAEA,IAAI,cAAc,aAAa;gBAC3B,eAAe,EAAE;gBACjB,SAAS;gBACT,WAAW,cAAc,MAAM,cAAc;gBAC7C;YACJ;YAEA,eAAe,EAAE;YACjB,SAAS;YAET,MAAM;6DAAmB;oBACrB,WAAW;oBACX,IAAI;wBACA,MAAM,MAAM,MAAM,MAAM,IAAA,+MAAU,EAAC,CAAC,kBAAkB,EAAE,SAAS;wBACjE,IAAI,IAAI,EAAE,EAAE;4BACR,MAAM,OAAO,MAAM,IAAI,IAAI;4BAC3B,eAAe;4BACf,SAAS;wBACb,OAAO;4BACH,SAAS;wBACb;wBAEA,IAAI;4BACA,MAAM,gBAAgB,MAAM,MAAM,IAAA,+MAAU,EAAC,CAAC,gBAAgB,EAAE,SAAS;4BACzE,IAAI,cAAc,EAAE,EAAE;gCAClB,MAAM,iBAAiB,MAAM,cAAc,IAAI;gCAC/C,cAAc,eAAe,KAAK,IAAI;gCACtC,gBAAgB,eAAe,OAAO,IAAI;4BAC9C;wBACJ,EAAE,OAAO,KAAK;4BACV,cAAc;4BACd,gBAAgB;wBACpB;oBACJ,EAAE,OAAO,KAAK;wBACV,SAAS;oBACb,SAAU;wBACN,WAAW;oBACf;gBACJ;;YAEA;QACJ;mCAAG;QAAC;QAAS;KAAU;IAEvB,MAAM,wBAAwB;QAC1B,IAAI,CAAC,SAAS;QAEd,gBAAgB;QAChB,SAAS;QAET,IAAI;YACA,MAAM,MAAM,MAAM,MAAM,IAAA,+MAAU,EAAC,CAAC,kBAAkB,EAAE,QAAQ,WAAW,CAAC,GAAG;gBAC3E,QAAQ;YACZ;YAEA,IAAI,IAAI,EAAE,EAAE;gBACR,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,eAAe;gBACf,SAAS;YACb,OAAO;gBACH,MAAM,YAAY,MAAM,IAAI,IAAI;gBAChC,SAAS,CAAC,sBAAsB,EAAE,WAAW;YACjD;QACJ,EAAE,OAAO,KAAK;YACV,SAAS;QACb,SAAU;YACN,gBAAgB;QACpB;IACJ;IAEA,OAAO;QACH;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACJ;AACJ;GA/FgB"}},
    {"offset": {"line": 5687, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/action-items/components/ActionItemsPanel.tsx"],"sourcesContent":["'use client';\r\n\r\nimport * as XLSX from 'xlsx';\r\nimport { getCategoryColor } from '@/shared/design/theme';\r\nimport { formatTime } from '@/shared/utils/formatTime';\r\nimport { formatDate } from '@/shared/utils/formatDate';\r\nimport { useActionItems, ActionItem } from '../hooks/useActionItems';\r\n\r\ninterface ActionItemsPanelProps {\r\n    mediaId: string | null;\r\n    jobId: string | null;\r\n    jobStatus: string;\r\n    onSeek: (time: number) => void;\r\n}\r\n\r\nexport default function ActionItemsPanel({ mediaId, jobId, jobStatus, onSeek }: ActionItemsPanelProps) {\r\n    const {\r\n        actionItems,\r\n        loading,\r\n        error,\r\n        videoTitle,\r\n        videoSummary,\r\n        regenerating,\r\n        regenerateActionItems,\r\n        setActionItems\r\n    } = useActionItems(mediaId, jobStatus);\r\n\r\n    const handleEmailDraft = (item: ActionItem) => {\r\n        const cleanActionItem = item.action_item.replace(new RegExp(`^${item.category}\\\\s*-\\\\s*`, 'i'), '');\r\n        const subject = `Action Required: ${item.category} - ${cleanActionItem}`;\r\n        const summarySnippet = videoSummary\r\n            ? videoSummary.substring(0, 300) + (videoSummary.length > 300 ? '...' : '')\r\n            : 'See video for full context.';\r\n\r\n        const body = `Hi ${item.responsible_party},\r\n\r\nAction Item from Meeting: ${videoTitle}\r\n\r\nTASK:\r\n${cleanActionItem}\r\n\r\nCATEGORY: ${item.category}\r\nDUE DATE: ${item.due_date}\r\nVIDEO TIMESTAMP: ${formatTime(item.timestamp)}\r\n\r\nMEETING CONTEXT:\r\n${summarySnippet}${item.notes ? `\r\n\r\nADDITIONAL NOTES:\r\n${item.notes}` : ''}\r\n\r\n---\r\nThis email was generated from Video Copilot. Please review and add any additional details before sending.`;\r\n\r\n        const outlookWebUrl = `https://outlook.office.com/mail/deeplink/compose?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;\r\n        window.open(outlookWebUrl, '_blank');\r\n    };\r\n\r\n    const handleExportToExcel = () => {\r\n        if (actionItems.length === 0) {\r\n            alert('No action items to export');\r\n            return;\r\n        }\r\n\r\n        const wb = XLSX.utils.book_new();\r\n        const headers = [\r\n            'Action Items Category',\r\n            'Action Item',\r\n            'Action Notes',\r\n            'Responsible Party',\r\n            'Due Date',\r\n            'My Notes'\r\n        ];\r\n\r\n        const data = actionItems.map(item => {\r\n            let cleanActionItem = item.action_item || '';\r\n            const categoryPrefix = `${item.category} - `;\r\n            if (cleanActionItem.startsWith(categoryPrefix)) {\r\n                cleanActionItem = cleanActionItem.substring(categoryPrefix.length);\r\n            }\r\n\r\n            return [\r\n                item.category || '',\r\n                cleanActionItem,\r\n                item.notes || '',\r\n                item.responsible_party || '',\r\n                item.due_date || '',\r\n                ''\r\n            ];\r\n        });\r\n\r\n        const wsData = [headers, ...data];\r\n        const ws = XLSX.utils.aoa_to_sheet(wsData);\r\n        ws['!cols'] = [\r\n            { wch: 25 }, { wch: 40 }, { wch: 30 }, { wch: 25 }, { wch: 15 }, { wch: 30 }\r\n        ];\r\n\r\n        XLSX.utils.book_append_sheet(wb, ws, 'Action Items');\r\n        const timestamp = new Date().toISOString().split('T')[0];\r\n        const sanitizedTitle = videoTitle.replace(/[^a-zA-Z0-9]/g, '_');\r\n        const filename = `${sanitizedTitle}_${timestamp}.xlsx`;\r\n        XLSX.writeFile(wb, filename);\r\n    };\r\n\r\n    return (\r\n        <div className=\"action-items-panel\">\r\n            <div className=\"panel-card\" style={{ height: '100%', display: 'flex', flexDirection: 'column' }}>\r\n                <div className=\"action-items-header\" style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center',\r\n                    padding: '1.5rem',\r\n                    borderBottom: `1px solid var(--border-default)`\r\n                }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '0.75rem' }}>\r\n                        <h2 style={{ fontSize: '1.3rem', fontWeight: '700', margin: 0, color: 'var(--action-task-text)' }}>\r\n                            Action Items {actionItems.length > 0 && `(${actionItems.length})`}\r\n                        </h2>\r\n                        {mediaId && (\r\n                            <button\r\n                                onClick={regenerateActionItems}\r\n                                disabled={regenerating || loading}\r\n                                title=\"Regenerate Action Items\"\r\n                                style={{\r\n                                    background: regenerating ? 'var(--border-default)' : 'transparent',\r\n                                    color: 'var(--text-secondary)',\r\n                                    border: `1px solid var(--border-default)`,\r\n                                    borderRadius: '50%',\r\n                                    width: '32px',\r\n                                    height: '32px',\r\n                                    cursor: regenerating || loading ? 'not-allowed' : 'pointer',\r\n                                    display: 'flex',\r\n                                    alignItems: 'center',\r\n                                    justifyContent: 'center',\r\n                                    transition: 'all 0.2s',\r\n                                    opacity: regenerating || loading ? 0.5 : 1\r\n                                }}\r\n                                onMouseEnter={(e) => {\r\n                                    if (!regenerating && !loading) {\r\n                                        e.currentTarget.style.background = 'var(--upload-hover-bg)';\r\n                                        e.currentTarget.style.borderColor = 'var(--primary)';\r\n                                        e.currentTarget.style.color = 'var(--primary)';\r\n                                    }\r\n                                }}\r\n                                onMouseLeave={(e) => {\r\n                                    if (!regenerating && !loading) {\r\n                                        e.currentTarget.style.background = 'transparent';\r\n                                        e.currentTarget.style.borderColor = 'var(--border-default)';\r\n                                        e.currentTarget.style.color = 'var(--text-secondary)';\r\n                                    }\r\n                                }}\r\n                            >\r\n                                <svg\r\n                                    width=\"16\"\r\n                                    height=\"16\"\r\n                                    viewBox=\"0 0 24 24\"\r\n                                    fill=\"none\"\r\n                                    stroke=\"currentColor\"\r\n                                    strokeWidth=\"2\"\r\n                                    strokeLinecap=\"round\"\r\n                                    strokeLinejoin=\"round\"\r\n                                    style={{\r\n                                        animation: regenerating ? 'spin 1s linear infinite' : 'none'\r\n                                    }}\r\n                                >\r\n                                    <path d=\"M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2\" />\r\n                                </svg>\r\n                            </button>\r\n                        )}\r\n                    </div>\r\n\r\n                    {actionItems.length > 0 && (\r\n                        <button\r\n                            onClick={handleExportToExcel}\r\n                            title=\"Export to Excel\"\r\n                            style={{\r\n                                background: 'var(--action-export-btn-bg)',\r\n                                color: 'var(--btn-success-text)',\r\n                                border: 'none',\r\n                                borderRadius: '6px',\r\n                                padding: '0.5rem 1rem',\r\n                                cursor: 'pointer',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                gap: '0.5rem',\r\n                                fontSize: '0.875rem',\r\n                                fontWeight: '600',\r\n                                transition: 'background 0.2s'\r\n                            }}\r\n                            onMouseEnter={(e) => e.currentTarget.style.opacity = '0.9'}\r\n                            onMouseLeave={(e) => e.currentTarget.style.opacity = '1'}\r\n                        >\r\n                            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\r\n                                <polyline points=\"14 2 14 8 20 8\"></polyline>\r\n                                <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\r\n                                <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\r\n                                <polyline points=\"10 9 9 9 8 9\"></polyline>\r\n                            </svg>\r\n                            Export to Excel\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"action-items-content\" style={{ flex: 1, padding: '1.5rem', overflowY: 'auto' }}>\r\n                    {!mediaId && (\r\n                        <div style={{ textAlign: 'center', opacity: 0.6, marginTop: '3rem', color: 'var(--text-secondary)' }}>\r\n                            <p>Upload a video to extract action items.</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {mediaId && loading && (\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            {[...Array(5)].map((_, i) => (\r\n                                <div key={i} className=\"skeleton\" style={{ height: '80px', borderRadius: '12px' }}></div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n\r\n                    {mediaId && error && actionItems.length === 0 && (\r\n                        <div style={{ textAlign: 'center', color: 'var(--status-error)', marginTop: '3rem' }}>\r\n                            <p>{error}</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {mediaId && !loading && !error && actionItems.length === 0 && (\r\n                        <div style={{ textAlign: 'center', opacity: 0.6, marginTop: '3rem', color: 'var(--text-secondary)' }}>\r\n                            <p>No action items detected in this video.</p>\r\n                            <p style={{ fontSize: '0.85rem', marginTop: '0.5rem' }}>\r\n                                Action items will appear here automatically.\r\n                            </p>\r\n                        </div>\r\n                    )}\r\n\r\n                    {actionItems.length > 0 && (\r\n                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>\r\n                            {actionItems.map((item) => (\r\n                                <div\r\n                                    key={item.id}\r\n                                    onClick={() => handleEmailDraft(item)}\r\n                                    style={{\r\n                                        padding: '1rem',\r\n                                        background: 'var(--action-card-bg)',\r\n                                        border: `1px solid var(--action-card-border)`,\r\n                                        borderRadius: '12px',\r\n                                        boxShadow: 'var(--action-card-shadow)',\r\n                                        transition: 'all 0.2s',\r\n                                        cursor: 'pointer',\r\n                                    }}\r\n                                    onMouseEnter={(e) => {\r\n                                        e.currentTarget.style.boxShadow = '0 4px 12px var(--modal-overlay)';\r\n                                    }}\r\n                                    onMouseLeave={(e) => {\r\n                                        e.currentTarget.style.boxShadow = 'var(--action-card-shadow)';\r\n                                    }}\r\n                                >\r\n                                    <div style={{\r\n                                        display: 'inline-block',\r\n                                        padding: '0.25rem 0.75rem',\r\n                                        background: getCategoryColor(item.category),\r\n                                        borderRadius: '6px',\r\n                                        fontSize: '0.75rem',\r\n                                        fontWeight: '600',\r\n                                        marginBottom: '0.75rem',\r\n                                        color: 'var(--action-badge-text)',\r\n                                        border: `1px solid var(--action-card-border)`,\r\n                                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)'\r\n                                    }}>\r\n                                        {item.category}\r\n                                    </div>\r\n\r\n                                    <p style={{\r\n                                        fontSize: '0.95rem',\r\n                                        margin: '0 0 0.75rem 0',\r\n                                        fontWeight: '500',\r\n                                        lineHeight: '1.5',\r\n                                        color: 'var(--action-task-text)'\r\n                                    }}>\r\n                                        {item.action_item.replace(new RegExp(`^${item.category}\\\\s*-\\\\s*`, 'i'), '')}\r\n                                    </p>\r\n\r\n                                    <div style={{\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        gap: '0.5rem',\r\n                                        fontSize: '0.85rem',\r\n                                        color: 'var(--action-meta-text)',\r\n                                        marginBottom: '0.5rem'\r\n                                    }}>\r\n                                        <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\">\r\n                                            <path d=\"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2\"></path>\r\n                                            <circle cx=\"12\" cy=\"7\" r=\"4\"></circle>\r\n                                        </svg>\r\n                                        <span>{item.responsible_party}</span>\r\n                                    </div>\r\n\r\n                                    <div style={{\r\n                                        display: 'flex',\r\n                                        alignItems: 'center',\r\n                                        justifyContent: 'space-between',\r\n                                        marginTop: '0.75rem',\r\n                                        paddingTop: '0.75rem',\r\n                                        borderTop: `1px solid var(--action-card-border)`\r\n                                    }}>\r\n                                        <span style={{ fontSize: '0.85rem', color: 'var(--action-meta-text)' }}>\r\n                                            {formatDate(item.due_date)}\r\n                                        </span>\r\n\r\n                                        <button\r\n                                            onClick={(e) => {\r\n                                                e.stopPropagation();\r\n                                                onSeek(item.timestamp);\r\n                                            }}\r\n                                            style={{\r\n                                                padding: '0.3rem 0.8rem',\r\n                                                background: 'var(--action-jump-btn-bg)',\r\n                                                color: 'var(--action-jump-btn-text)',\r\n                                                border: `1px solid var(--action-jump-btn-text)`,\r\n                                                borderRadius: '6px',\r\n                                                fontSize: '0.8rem',\r\n                                                fontWeight: '600',\r\n                                                cursor: 'pointer',\r\n                                                display: 'flex',\r\n                                                alignItems: 'center',\r\n                                                gap: '0.3rem',\r\n                                                transition: 'all 0.2s'\r\n                                            }}\r\n                                            onMouseEnter={(e) => {\r\n                                                e.currentTarget.style.background = 'var(--action-jump-btn-text)';\r\n                                                e.currentTarget.style.color = 'white';\r\n                                            }}\r\n                                            onMouseLeave={(e) => {\r\n                                                e.currentTarget.style.background = 'var(--action-jump-btn-bg)';\r\n                                                e.currentTarget.style.color = 'var(--action-jump-btn-text)';\r\n                                            }}\r\n                                        >\r\n                                            <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"2\" strokeLinecap=\"round\" strokeLinejoin=\"round\">\r\n                                                <path d=\"M13 5l7 7-7 7M5 12h14\" />\r\n                                            </svg>\r\n                                            Jump\r\n                                        </button>\r\n                                    </div>\r\n\r\n                                    {item.notes && (\r\n                                        <div style={{\r\n                                            marginTop: '0.75rem',\r\n                                            padding: '0.5rem',\r\n                                            background: 'var(--action-note-bg)',\r\n                                            borderRadius: '6px',\r\n                                            fontSize: '0.8rem',\r\n                                            color: 'var(--action-note-text)',\r\n                                            fontStyle: 'italic'\r\n                                        }}>\r\n                                            Note: {item.notes}\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6351, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/features/auth/components/AuthGate.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useMsal } from \"@azure/msal-react\";\r\nimport { loginRequest } from \"@/lib/msalConfig\";\r\nimport { getApiPath } from '@/shared/utils/apiPath';\r\nimport { InteractionStatus } from \"@azure/msal-browser\";\r\n\r\nexport default function AuthGate() {\r\n    const { instance, inProgress } = useMsal();\r\n\r\n    const handleLogin = () => {\r\n        // Don't start a new login if one is already in progress\r\n        if (inProgress !== InteractionStatus.None) {\r\n            console.log('Login already in progress, please wait...');\r\n            return;\r\n        }\r\n\r\n        // Use redirect flow - simpler and more reliable than popup\r\n        instance.loginRedirect(loginRequest);\r\n    };\r\n\r\n\r\n    return (\r\n        <div style={{\r\n            minHeight: '100vh',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            background: 'linear-gradient(135deg, #96a9ffff 0%, #4b74a2ff 100%)',\r\n            padding: '2rem'\r\n        }}>\r\n            <div style={{\r\n                background: 'var(--surface)',\r\n                borderRadius: '16px',\r\n                padding: '3rem 2rem',\r\n                maxWidth: '450px',\r\n                width: '100%',\r\n                textAlign: 'center',\r\n                boxShadow: '0 20px 60px rgba(0,0,0,0.3)',\r\n                color: 'var(--text-primary)'\r\n            }}>\r\n                {/* Logo/Brand Area */}\r\n                <div style={{\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    gap: '1.25rem',\r\n                    marginBottom: '2.5rem'\r\n                }}>\r\n                    {/* DrCloudEHR Logo */}\r\n                    <img\r\n                        src={getApiPath('/EnSoftek - DrCloudEHR Logo.png')}\r\n                        alt=\"DrCloudEHR GTD\"\r\n                        style={{\r\n                            height: '100px',\r\n                            width: 'auto'\r\n                        }}\r\n                    />\r\n\r\n                    {/* Brand Names - Stacked Vertically */}\r\n                    <div style={{\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        alignItems: 'center',\r\n                        gap: '0.25rem'\r\n                    }}>\r\n                        <span style={{\r\n                            fontSize: '1.8rem',\r\n                            fontWeight: '600',\r\n                            fontFamily: '\"Noto Sans\", sans-serif',\r\n                            color: 'var(--text-primary)',\r\n                            letterSpacing: '0.5px'\r\n                        }}>\r\n                            DrCloudEHR\r\n                        </span>\r\n                        <span style={{\r\n                            fontSize: '2.6rem',\r\n                            fontWeight: '600',\r\n                            fontFamily: '\"Bebas Neue\", sans-serif',\r\n                            color: '#667eea',\r\n                            lineHeight: '1'\r\n                        }}>\r\n                            GetThingsDone\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Sign-in Button */}\r\n                <button\r\n                    onClick={handleLogin}\r\n                    disabled={inProgress !== InteractionStatus.None}\r\n                    style={{\r\n                        width: '100%',\r\n                        padding: '1rem 1.5rem',\r\n                        background: '#0078d4',\r\n                        color: 'white',\r\n                        border: 'none',\r\n                        borderRadius: '8px',\r\n                        cursor: 'pointer',\r\n                        fontSize: '1rem',\r\n                        fontWeight: '600',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        gap: '0.75rem',\r\n                        transition: 'all 0.2s'\r\n                    }}\r\n                    onMouseEnter={(e) => e.currentTarget.style.background = '#006cbe'}\r\n                    onMouseLeave={(e) => e.currentTarget.style.background = '#0078d4'}\r\n                >\r\n                    {/* Microsoft Logo SVG */}\r\n                    <svg width=\"24\" height=\"24\" viewBox=\"0 0 23 23\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                        <rect width=\"11\" height=\"11\" fill=\"white\" />\r\n                        <rect y=\"12\" width=\"11\" height=\"11\" fill=\"white\" />\r\n                        <rect x=\"12\" width=\"11\" height=\"11\" fill=\"white\" />\r\n                        <rect x=\"12\" y=\"12\" width=\"11\" height=\"11\" fill=\"white\" />\r\n                    </svg>\r\n                    Sign in with Microsoft\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAAA;AACA;AACA;AACA;;;AALA;;;;;AAOe,SAAS;;IACpB,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,IAAA,+OAAO;IAExC,MAAM,cAAc;QAChB,wDAAwD;QACxD,IAAI,eAAe,qQAAiB,CAAC,IAAI,EAAE;YACvC,QAAQ,GAAG,CAAC;YACZ;QACJ;QAEA,2DAA2D;QAC3D,SAAS,aAAa,CAAC,wMAAY;IACvC;IAGA,qBACI,0PAAC;QAAI,OAAO;YACR,WAAW;YACX,SAAS;YACT,YAAY;YACZ,gBAAgB;YAChB,YAAY;YACZ,SAAS;QACb;kBACI,cAAA,0PAAC;YAAI,OAAO;gBACR,YAAY;gBACZ,cAAc;gBACd,SAAS;gBACT,UAAU;gBACV,OAAO;gBACP,WAAW;gBACX,WAAW;gBACX,OAAO;YACX;;8BAEI,0PAAC;oBAAI,OAAO;wBACR,SAAS;wBACT,eAAe;wBACf,YAAY;wBACZ,gBAAgB;wBAChB,KAAK;wBACL,cAAc;oBAClB;;sCAEI,0PAAC;4BACG,KAAK,IAAA,+MAAU,EAAC;4BAChB,KAAI;4BACJ,OAAO;gCACH,QAAQ;gCACR,OAAO;4BACX;;;;;;sCAIJ,0PAAC;4BAAI,OAAO;gCACR,SAAS;gCACT,eAAe;gCACf,YAAY;gCACZ,KAAK;4BACT;;8CACI,0PAAC;oCAAK,OAAO;wCACT,UAAU;wCACV,YAAY;wCACZ,YAAY;wCACZ,OAAO;wCACP,eAAe;oCACnB;8CAAG;;;;;;8CAGH,0PAAC;oCAAK,OAAO;wCACT,UAAU;wCACV,YAAY;wCACZ,YAAY;wCACZ,OAAO;wCACP,YAAY;oCAChB;8CAAG;;;;;;;;;;;;;;;;;;8BAOX,0PAAC;oBACG,SAAS;oBACT,UAAU,eAAe,qQAAiB,CAAC,IAAI;oBAC/C,OAAO;wBACH,OAAO;wBACP,SAAS;wBACT,YAAY;wBACZ,OAAO;wBACP,QAAQ;wBACR,cAAc;wBACd,QAAQ;wBACR,UAAU;wBACV,YAAY;wBACZ,SAAS;wBACT,YAAY;wBACZ,gBAAgB;wBAChB,KAAK;wBACL,YAAY;oBAChB;oBACA,cAAc,CAAC,IAAM,EAAE,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG;oBACxD,cAAc,CAAC,IAAM,EAAE,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG;;sCAGxD,0PAAC;4BAAI,OAAM;4BAAK,QAAO;4BAAK,SAAQ;4BAAY,MAAK;4BAAO,OAAM;;8CAC9D,0PAAC;oCAAK,OAAM;oCAAK,QAAO;oCAAK,MAAK;;;;;;8CAClC,0PAAC;oCAAK,GAAE;oCAAK,OAAM;oCAAK,QAAO;oCAAK,MAAK;;;;;;8CACzC,0PAAC;oCAAK,GAAE;oCAAK,OAAM;oCAAK,QAAO;oCAAK,MAAK;;;;;;8CACzC,0PAAC;oCAAK,GAAE;oCAAK,GAAE;oCAAK,OAAM;oCAAK,QAAO;oCAAK,MAAK;;;;;;;;;;;;wBAC9C;;;;;;;;;;;;;;;;;;AAM1B;GApHwB;;QACa,+OAAO;;;KADpB"}},
    {"offset": {"line": 6580, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/herei/.gemini/antigravity/scratch/video_copilot_fresh/src/app/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport FileUploader, { FileUploaderRef } from '@/features/upload/components/FileUploader';\r\nimport VideoPlayer, { VideoPlayerRef } from '@/features/player/components/VideoPlayer';\r\nimport IntelligencePanel from '@/features/intelligence/components/IntelligencePanel';\r\nimport TranscriptPanel from '@/features/transcript/components/TranscriptPanel';\r\nimport ActionItemsPanel from '@/features/action-items/components/ActionItemsPanel';\r\nimport AuthGate from '@/features/auth/components/AuthGate';\r\nimport { useState, useRef, useEffect } from 'react';\r\nimport { useMsal, useIsAuthenticated } from '@azure/msal-react';\r\nimport { InteractionStatus } from '@azure/msal-browser';\r\n\r\nimport PersonalityChooser, { Personality } from '@/features/personality/components/PersonalityChooser';\r\n\r\nimport { saveVideoToLocal, getVideoFromLocal, downloadVideoFromServer } from '@/lib/browserStorage';\r\n\r\nexport default function Home() {\r\n  const { inProgress, accounts } = useMsal();\r\n  const isAuthenticated = useIsAuthenticated();\r\n  const [activeMediaId, setActiveMediaId] = useState<string | null>(null);\r\n  const [activeJobId, setActiveJobId] = useState<string | null>(null);\r\n  const [jobStatus, setJobStatus] = useState<string>('');\r\n  const [jobProgress, setJobProgress] = useState<number>(0);\r\n  const [personality, setPersonality] = useState<Personality>('meetings');\r\n  const [highlightTimestamp, setHighlightTimestamp] = useState<number | null>(null);\r\n\r\n  // Load personality from localStorage\r\n  useEffect(() => {\r\n    if (typeof window !== 'undefined') {\r\n      const saved = localStorage.getItem('videocopilot_personality') as Personality;\r\n      if (saved && ['meetings', 'training', 'support'].includes(saved)) {\r\n        setPersonality(saved);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  // Save personality to localStorage\r\n  const handlePersonalityChange = (newPersonality: Personality) => {\r\n    setPersonality(newPersonality);\r\n    if (typeof window !== 'undefined') {\r\n      localStorage.setItem('videocopilot_personality', newPersonality);\r\n    }\r\n    // Reset session state when switching modes\r\n    setActiveMediaId(null);\r\n    setActiveJobId(null);\r\n    setJobStatus('');\r\n    setJobProgress(0);\r\n  };\r\n\r\n  // Auto-download video to local storage upon completion (for SharePoint imports)\r\n  useEffect(() => {\r\n    async function checkAndDownload() {\r\n      if (jobStatus === 'COMPLETED' && activeMediaId && accounts[0]?.username) {\r\n        const userEmail = accounts[0].username;\r\n        // Check if we have it locally\r\n        const existing = await getVideoFromLocal(activeMediaId, userEmail);\r\n        if (!existing) {\r\n          console.log(`[Page] Job completed but video missing locally (likely SharePoint import). Downloading...`);\r\n          await downloadVideoFromServer(activeMediaId, userEmail);\r\n        }\r\n      }\r\n    }\r\n    checkAndDownload();\r\n  }, [jobStatus, activeMediaId, accounts]);\r\n\r\n  const videoPlayerRef = useRef<VideoPlayerRef>(null);\r\n  const fileUploaderRef = useRef<FileUploaderRef>(null);\r\n\r\n  // Gate entire app behind authentication (unless bypass is enabled)\r\n  const isAuthBypassed = process.env.NEXT_PUBLIC_BYPASS_AUTH === 'true';\r\n  const isDevBypassed = typeof window !== 'undefined' && localStorage.getItem('devBypassAuth') === 'true';\r\n\r\n  // If MSAL is currently processing (login, logout, or handling redirect), show nothing\r\n  if (inProgress !== InteractionStatus.None) {\r\n    return null;\r\n  }\r\n\r\n  // If not authenticated and not bypassed, show login page\r\n  if (!isAuthBypassed && !isDevBypassed && !isAuthenticated) {\r\n    return <AuthGate />;\r\n  }\r\n\r\n  const handleUploadComplete = (mediaId: string, jobId: string) => {\r\n    setActiveMediaId(mediaId);\r\n    setActiveJobId(jobId);\r\n    setJobStatus('QUEUED');\r\n    setJobProgress(0);\r\n    console.log('Upload complete, mediaId:', mediaId, 'jobId:', jobId);\r\n  };\r\n\r\n  const handleLoadExisting = (mediaId: string) => {\r\n    setActiveMediaId(mediaId);\r\n    setActiveJobId(null);       // No job to poll — content already exists\r\n    setJobStatus('COMPLETED');\r\n    setJobProgress(100);\r\n    console.log('Loading existing media:', mediaId);\r\n  };\r\n\r\n  const handleSeek = (time: number) => {\r\n    videoPlayerRef.current?.seekTo(time);\r\n    setHighlightTimestamp(time);\r\n  };\r\n\r\n  const handleFileDrop = (file: File) => {\r\n    fileUploaderRef.current?.uploadFile(file);\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    setActiveMediaId(null);\r\n    setActiveJobId(null);\r\n    setJobStatus('');\r\n    setJobProgress(0);\r\n    console.log('Job cancelled and state reset');\r\n  };\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <FileUploader\r\n        ref={fileUploaderRef}\r\n        onUploadComplete={handleUploadComplete}\r\n        onLoadExisting={handleLoadExisting}\r\n        currentJobStatus={jobStatus}\r\n        currentJobProgress={jobProgress}\r\n        onCancel={handleCancel}\r\n        personality={personality}\r\n        onPersonalityChange={handlePersonalityChange}\r\n      />\r\n\r\n      <main className=\"main-layout\">\r\n        <div className=\"left-column\">\r\n          <VideoPlayer\r\n            ref={videoPlayerRef}\r\n            mediaId={activeMediaId}\r\n            jobStatus={jobStatus}\r\n            onFileDrop={handleFileDrop}\r\n          />\r\n          <TranscriptPanel\r\n            mediaId={activeMediaId}\r\n            jobId={activeJobId}\r\n            jobStatus={jobStatus}\r\n            onSeek={handleSeek}\r\n            highlightTimestamp={highlightTimestamp}\r\n            onHighlightDone={() => setHighlightTimestamp(null)}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"middle-column\">\r\n          <IntelligencePanel\r\n            mediaId={activeMediaId}\r\n            jobId={activeJobId}\r\n            onSeek={handleSeek}\r\n            onStatusChange={setJobStatus}\r\n            onProgressChange={setJobProgress}\r\n            personality={personality}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"right-column\">\r\n          <ActionItemsPanel\r\n            mediaId={activeMediaId}\r\n            jobId={activeJobId}\r\n            jobStatus={jobStatus}\r\n            onSeek={handleSeek}\r\n          />\r\n        </div>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}